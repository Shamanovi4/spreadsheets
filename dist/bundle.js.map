{"version":3,"sources":["webpack://spreadsheets/./src/core/parse.js","webpack://spreadsheets/webpack/bootstrap","webpack://spreadsheets/webpack/runtime/define property getters","webpack://spreadsheets/webpack/runtime/hasOwnProperty shorthand","webpack://spreadsheets/./src/core/dom.js","webpack://spreadsheets/./src/components/Loader.js","webpack://spreadsheets/./src/core/routes/ActiveRoute.js","webpack://spreadsheets/./src/core/page/Page.js","webpack://spreadsheets/./src/core/utils.js","webpack://spreadsheets/./src/shared/dashboard.functions.js","webpack://spreadsheets/./src/core/Emitter.js","webpack://spreadsheets/./src/core/StoreSubscriber.js","webpack://spreadsheets/./src/redux/types.js","webpack://spreadsheets/./src/components/spreadsheet/Spreadsheet.js","webpack://spreadsheets/./src/redux/actions.js","webpack://spreadsheets/./src/core/DomListener.js","webpack://spreadsheets/./src/core/SpreadsheetComponent.js","webpack://spreadsheets/./src/constants.js","webpack://spreadsheets/./src/components/header/Header.js","webpack://spreadsheets/./src/core/SpreadsheetStateComponent.js","webpack://spreadsheets/./src/components/toolbar/toolbar.template.js","webpack://spreadsheets/./src/components/toolbar/Toolbar.js","webpack://spreadsheets/./src/components/formula/Formula.js","webpack://spreadsheets/./src/components/table/table.template.js","webpack://spreadsheets/./src/components/table/TableSelection.js","webpack://spreadsheets/./src/components/table/Table.js","webpack://spreadsheets/./src/components/table/table.resize.js","webpack://spreadsheets/./src/components/table/table.functions.js","webpack://spreadsheets/./src/redux/rootReducer.js","webpack://spreadsheets/./src/redux/initialState.js","webpack://spreadsheets/./src/core/page/StateProcessor.js","webpack://spreadsheets/./src/shared/LocalStorageClient.js","webpack://spreadsheets/./src/index.js","webpack://spreadsheets/./src/core/routes/Router.js","webpack://spreadsheets/./src/pages/DashboardPage.js","webpack://spreadsheets/./src/pages/SpreadsheetPage.js","webpack://spreadsheets/./src/core/store/createStore.js"],"names":["parse","value","startsWith","eval","slice","e","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Dom","constructor","selector","this","$el","document","querySelector","html","innerHTML","outerHTML","trim","clear","text","textContent","tagName","toLowerCase","append","node","Element","appendChild","on","eventType","callback","addEventListener","off","removeEventListener","closest","$","getCoords","getBoundingClientRect","getOffset","top","offsetTop","left","offsetLeft","getScroll","scrollTop","scrollLeft","dataset","findAll","querySelectorAll","findDom","getPropertyValue","property","pseudoElement","window","getComputedStyle","css","styles","keys","forEach","style","getStyles","reduce","res","s","addClass","className","classList","add","removeClass","remove","id","parsed","split","row","col","data","focus","attribute","name","setAttribute","getAttribute","Loader","create","classes","el","createElement","ActiveRoute","location","hash","path","Page","params","Date","now","toString","getRoot","Error","afterRender","destroy","storage","JSON","localStorage","getItem","setItem","stringify","wrap","content","wrapperTag","wrapperClass","debounce","fn","wait","timeout","args","clearTimeout","setTimeout","apply","preventDefault","event","toHTML","model","tableTitle","lastOpenedDate","toLocaleDateString","toLocaleTimeString","Emitter","listeners","emit","eventName","Array","isArray","listener","subscribe","func","push","filter","StoreSubscriber","store","sub","prevState","subscribeComponents","components","getState","state","a","b","component","isWatching","changes","storeChanged","unsubscribeFromStore","unsubscribe","TABLE_RESIZE","CHANGE_TEXT","APPLY_STYLE","CHANGE_STYLES","CHANGE_TITLE","UPDATE_DATE","Spreadsheet","options","emitter","subscriber","$root","componentOptions","map","Component","init","dispatch","type","getMethodName","string","charAt","toUpperCase","SpreadsheetComponent","initDOMListeners","method","bind","removeDOMListeners","super","unsubscribers","storeSub","prepare","$emit","$on","unsub","$dispatch","action","includes","defaultStyles","justifyContent","fontWeight","textDecoration","fontStyle","activeDropDown","defaultTitle","Header","onInput","onClick","$target","target","buttonType","confirm","removeItem","param","SpreadsheetStateComponent","initState","initialState","setState","newState","template","toButton","buttonClass","isDropDown","button","active","icon","whichAlign","Toolbar","buttons","fontButtons","join","alignButtons","alignDropDown","createToolbar","currentStyles","mergedValue","Formula","$formula","$cell","currentText","onKeydown","toChar","index","String","fromCharCode","getWidth","getHeight","toCell","_","indexChar","width","colState","dataState","str","replace","g","toInlineStyles","stylesState","toColLabel","createRow","rowState","rowType","TableSelection","group","current","selection","labels","rows","cols","range","start","end","fill","setClasses","$notationRow","notationTypes","$notationCol","$col","$row","$cols","$rows","selectionBordered","selectionClasses","bordered","selectionHandler","onmousemove","elementFromPoint","pageX","pageY","cell","selectGroup","onmouseup","setSelectionCSS","right","bottom","scroll","offset","height","setSelection","targetId","currentId","targetCoords","currentCoords","selectionType","$gridScrollable","scrollableType","$gridFixed","fixedType","$grid","gridType","select","$cells","acc","applyStyle","Table","tableSize","rowsCount","colsCount","notationRow","withWidthFrom","notationCol","withHeightFrom","toRowLabel","cells","grid","createTable","tableSelection","selectCell","updateTextInStore","ids","selectedIds","Promise","resolve","$resizer","$parent","resize","rowId","findRow","coords","$resizerLine","minValue","Number","tableHeight","delta","resizeHandler","actions","console","warn","message","onMousedown","shouldResize","isCell","shiftKey","resizeTable","$next","nextSelector","rootReducer","field","val","getValue","toJSON","defaultState","StateProcessor","client","delay","listen","save","LocalStorageClient","routes","$placeholder","loader","page","changePageHandler","spreadsheet","dashboard","root","i","length","getAllKeys","createSpreadsheetsTable","processor","createStore","normalize","clone"],"mappings":"oHAAO,SAASA,MAAMC,MAAQ,IAC5B,GAAIA,MAAMC,WAAW,KACnB,IACE,OAAOC,KAAKF,MAAMG,MAAM,IACxB,MAAOC,GACP,OAAOJ,MAGX,OAAOA,M,2DCPLK,yBAA2B,GAG/B,SAASC,oBAAoBC,GAE5B,GAAGF,yBAAyBE,GAC3B,OAAOF,yBAAyBE,GAAUC,QAG3C,IAAIC,EAASJ,yBAAyBE,GAAY,CAGjDC,QAAS,IAOV,OAHAE,oBAAoBH,GAAUE,EAAQA,EAAOD,QAASF,qBAG/CG,EAAOD,QCnBfF,oBAAoBK,EAAI,CAACH,EAASI,KACjC,IAAI,IAAIC,KAAOD,EACXN,oBAAoBQ,EAAEF,EAAYC,KAASP,oBAAoBQ,EAAEN,EAASK,IAC5EE,OAAOC,eAAeR,EAASK,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3EP,oBAAoBQ,EAAI,CAACK,EAAKC,IAASL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,G,MCAjF,MAAMI,EACJC,YAAYC,GACVC,KAAKC,IAA0B,iBAAbF,EACdG,SAASC,cAAcJ,GACvBA,EAGNK,KAAKA,GACH,MAAoB,iBAATA,GACTJ,KAAKC,IAAII,UAAYD,EACdJ,MAEFA,KAAKC,IAAIK,UAAUC,OAG5BC,QAEE,OADAR,KAAKI,KAAK,IACHJ,KAGTS,KAAKA,GACH,MAAoB,iBAATA,GAAqC,iBAATA,GACrCT,KAAKC,IAAIS,YAAcD,EAChBT,MAE8B,UAAnCA,KAAKC,IAAIU,QAAQC,cACZZ,KAAKC,IAAI5B,MAAMkC,OAEjBP,KAAKC,IAAIS,YAAYH,OAG9BM,OAAOC,GACDA,aAAgBjB,IAClBiB,EAAOA,EAAKb,KAEVc,QAAQrB,UAAUmB,OACpBb,KAAKC,IAAIY,OAAOC,GAEhBd,KAAKC,IAAIe,YAAYF,GAIzBG,GAAGC,EAAWC,GACZnB,KAAKC,IAAImB,iBAAiBF,EAAWC,GAGvCE,IAAIH,EAAWC,GACbnB,KAAKC,IAAIqB,oBAAoBJ,EAAWC,GAG1CI,QAAQxB,GACN,OAAOyB,EAAExB,KAAKC,IAAIsB,QAAQxB,IAG5B0B,YACE,OAAOzB,KAAKC,IAAIyB,wBAGlBC,YACE,MAAO,CACLC,IAAK5B,KAAKC,IAAI4B,UACdC,KAAM9B,KAAKC,IAAI8B,YAInBC,YACE,MAAO,CACLJ,IAAK5B,KAAKC,IAAIgC,UACdH,KAAM9B,KAAKC,IAAIiC,YAIX,WACN,OAAOlC,KAAKC,IAAIkC,QAGlBC,QAAQrC,GACN,OAAOC,KAAKC,IAAIoC,iBAAiBtC,GAGnCuC,QAAQvC,GACN,OAAOyB,EAAExB,KAAKC,IAAIE,cAAcJ,IAGlCwC,iBAAiBxC,EAAUyC,EAAUC,GACnC,OAAOC,OAAOC,iBAAiB5C,EAAU0C,GACpCF,iBAAiBC,GAGxBI,IAAIC,EAAS,IACXzD,OAAO0D,KAAKD,GAAQE,SAAQ7D,IAC1Bc,KAAKC,IAAI+C,MAAM9D,GAAO2D,EAAO3D,MAIjC+D,UAAUJ,EAAS,IACjB,OAAOA,EAAOK,QAAO,CAACC,EAAKC,KACzBD,EAAIC,GAAKpD,KAAKC,IAAI+C,MAAMI,GACjBD,IACN,IAGLE,SAASC,GACPtD,KAAKC,IAAIsD,UAAUC,IAAIF,GAGzBG,YAAYH,GACVtD,KAAKC,IAAIsD,UAAUG,OAAOJ,GAG5BK,GAAGvF,GACD,GAAIA,EAAO,CACT,MAAMwF,EAAS5D,KAAK2D,KAAKE,MAAM,KAC/B,MAAO,CACLC,KAAMF,EAAO,GACbG,KAAMH,EAAO,IAGjB,OAAO5D,KAAKgE,KAAKL,GAGnBM,QAEE,OADAjE,KAAKC,IAAIgE,QACFjE,KAGTkE,UAAUC,EAAM9F,GACd,OAAIA,GACF2B,KAAKC,IAAImE,aAAaD,EAAM9F,GACrB2B,MAEFA,KAAKC,IAAIoE,aAAaF,IAI1B,SAAS3C,EAAEzB,GAChB,OAAO,IAAIF,EAAIE,GCtIV,SAASuE,IACd,OAAO9C,EAAE+C,OAAO,MAAO,UAAUnE,KAAM,uRDwIzCoB,EAAE+C,OAAS,CAAC5D,EAAS6D,EAAU,MAC7B,MAAMC,EAAKvE,SAASwE,cAAc/D,GAIlC,OAHI6D,GACFC,EAAGlB,UAAUC,IAAIgB,GAEZhD,EAAEiD,IEhJJ,MAAME,EACI,kBACb,OAAOjC,OAAOkC,SAASC,KAAKrG,MAAM,GAGpB,mBACd,OAAOmG,EAAYG,KAAKjB,MAAM,KAAK,GAGtB,gBAACiB,GACdpC,OAAOkC,SAASC,KAAOC,GCVpB,MAAMC,EACXjF,YAAYkF,GACVhF,KAAKgF,OAASA,GAAUC,KAAKC,MAAMC,WAGrCC,UACE,MAAM,IAAIC,MAAM,0CAGlBC,eAEAC,YCJK,SAASC,EAAQtG,EAAK8E,EAAO,MAClC,IAAKA,EACH,OAAOyB,KAAKrH,MAAMsH,aAAaC,QAAQzG,IAEzCwG,aAAaE,QAAQ1G,EAAKuG,KAAKI,UAAU7B,IAUpC,SAAS8B,EAAKC,EAASC,EAAYC,EAAcjC,GAEtD,MAAQ,QACLgC,YAAqBC,WAFQ,IAAVjC,EAAwB,GAAKA,WAG/C+B,UACAC,SAcC,SAASE,EAASC,EAAIC,GAC3B,IAAIC,EACJ,OAAO,YAAYC,GAMjBC,aAAaF,GACbA,EAAUG,YANI,KACZD,aAAaF,GAEbF,EAAGM,MAAMzG,KAAMsG,KAGWF,IAQzB,SAASM,EAAeC,GAC7BA,EAAMD,iBCxDD,SAASE,EAAO1H,GACrB,MAAM2H,EAAQrB,EAAQtG,GAEtB,MAAQ,6GADGA,EAAI2E,MAAM,KAAK,2DAIwBgD,EAAMC,kFAEhD,IAAI7B,KAAK4B,EAAME,gBAAgBC,iCAC/B,IAAI/B,KAAK4B,EAAME,gBAAgBE,6DCXlC,MAAMC,EACXpH,cACEE,KAAKmH,UAAY,GAKnBC,KAAKC,KAAcf,GACjB,QAAKgB,MAAMC,QAAQvH,KAAKmH,UAAUE,MAGlCrH,KAAKmH,UAAUE,GAAWtE,SAAQyE,IAChCA,KAAYlB,OAEP,GAKTmB,UAAUJ,EAAWK,GAGnB,OAFA1H,KAAKmH,UAAUE,GAAarH,KAAKmH,UAAUE,IAAc,GACzDrH,KAAKmH,UAAUE,GAAWM,KAAKD,GACxB,KACL1H,KAAKmH,UAAUE,GAAarH,KAAKmH,UAAUE,GACtCO,QAAOJ,GAAYA,IAAaE,MCtBpC,MAAMG,EACX/H,YAAYgI,GACV9H,KAAK8H,MAAQA,EACb9H,KAAK+H,IAAM,KACX/H,KAAKgI,UAAY,GAGnBC,oBAAoBC,GAClBlI,KAAKgI,UAAYhI,KAAK8H,MAAMK,WAE5BnI,KAAK+H,IAAM/H,KAAK8H,MAAML,WAAUW,IAC9BhJ,OAAO0D,KAAKsF,GAAOrF,SAAQ7D,IHC1B,IAAiBmJ,EAAGC,EAAHD,EGAHrI,KAAKgI,UAAU9I,GHAToJ,EGAeF,EAAMlJ,IHC7B,iBAANmJ,GAA+B,iBAANC,EAC3B7C,KAAKI,UAAUwC,KAAO5C,KAAKI,UAAUyC,GAEvCD,IAAMC,IGHLJ,EAAWnF,SAAQwF,IACjB,GAAIA,EAAUC,WAAWtJ,GAAM,CAC7B,MAAMuJ,EAAU,CAAC,CAACvJ,GAAMkJ,EAAMlJ,IAC9BqJ,EAAUG,aAAaD,UAM/BzI,KAAKgI,UAAYhI,KAAK8H,MAAMK,cAIhCQ,uBACE3I,KAAK+H,IAAIa,eC7BN,MAAMC,EAAe,eACfC,EAAc,cACdC,EAAc,cACdC,EAAgB,gBAChBC,EAAe,eACfC,EAAc,cCCpB,MAAMC,EACXrJ,YAAYsJ,GACVpJ,KAAKkI,WAAakB,EAAQlB,YAAc,GACxClI,KAAK8H,MAAQsB,EAAQtB,MACrB9H,KAAKqJ,QAAU,IAAInC,EACnBlH,KAAKsJ,WAAa,IAAIzB,EAAgB7H,KAAK8H,OAG7C1C,UACE,MAAMmE,EAAQ/H,EAAE+C,OAAO,MAAO,eAExBiF,EAAmB,CACvBH,QAASrJ,KAAKqJ,QACdvB,MAAO9H,KAAK8H,OAWd,OARA9H,KAAKkI,WAAalI,KAAKkI,WAAWuB,KAAIC,IACpC,MAAMzJ,EAAMuB,EAAE+C,OAAO,MAAOmF,EAAUpG,WAChCiF,EAAY,IAAImB,EAAUzJ,EAAKuJ,GAGrC,OAFAvJ,EAAIG,KAAKmI,EAAU3B,UACnB2C,EAAM1I,OAAOZ,GACNsI,KAGFgB,EAGTI,OAIE3J,KAAK8H,MAAM8B,SCQN,CACLC,KAAMX,IDRNlJ,KAAKsJ,WAAWrB,oBAAoBjI,KAAKkI,YACzClI,KAAKkI,WAAWnF,SAAQwF,GAAaA,EAAUoB,SAGjDpE,UACEvF,KAAKsJ,WAAWX,uBAChB3I,KAAKkI,WAAWnF,SAAQwF,GAAaA,EAAUhD,YAC/CrF,SAASoB,oBAAoB,cAAeoF,IEVhD,SAASoD,EAAczC,GACrB,MAAO,MPnCe,iBADG0C,EOoCA1C,GPlChB,GAEF0C,EAAOC,OAAO,GAAGC,cAAgBF,EAAOvL,MAAM,IAJhD,IAAoBuL,EQEpB,MAAMG,UDAN,MACLpK,YAAYyJ,EAAOpC,EAAY,IAC7B,IAAKoC,EACH,MAAM,IAAIlE,MAAO,sCAEnBrF,KAAKuJ,MAAQA,EACbvJ,KAAKmH,UAAYA,EAGnBgD,mBACEnK,KAAKmH,UAAUpE,SAAQyE,IACrB,MAAM4C,EAASN,EAActC,GAC7B,IAAKxH,KAAKoK,GAAS,CACjB,MAAMjG,EAAOnE,KAAKmE,KAClB,MAAM,IAAIkB,MACL,UAAS+E,2BAAgCjG,eAGhDnE,KAAKoK,GAAUpK,KAAKoK,GAAQC,KAAKrK,MACjCA,KAAKuJ,MAAMtI,GAAGuG,EAAUxH,KAAKoK,OAIjCE,qBACEtK,KAAKmH,UAAUpE,SAAQyE,IACrB,MAAM4C,EAASN,EAActC,GACzBxH,KAAKoK,IACPpK,KAAKuJ,MAAMlI,IAAImG,EAAUxH,KAAKoK,SC1BpCtK,YAAYyJ,EAAOH,EAAU,IAC3BmB,MAAMhB,EAAOH,EAAQjC,WACrBnH,KAAKmE,KAAOiF,EAAQjF,MAAQ,GAC5BnE,KAAKqJ,QAAUD,EAAQC,QACvBrJ,KAAKyH,UAAY2B,EAAQ3B,WAAa,GACtCzH,KAAKwK,cAAgB,GACrBxK,KAAK8H,MAAQsB,EAAQtB,MACrB9H,KAAKyK,SAAW,KAEhBzK,KAAK0K,UAIPA,WAGA9D,SACE,MAAO,GAIT+D,MAAMhE,KAAUL,GACdtG,KAAKqJ,QAAQjC,KAAKT,KAAUL,GAI9BsE,IAAIjE,EAAOe,GACT,MAAMmD,EAAQ7K,KAAKqJ,QAAQ5B,UAAUd,EAAOe,GAC5C1H,KAAKwK,cAAc7C,KAAKkD,GAG1BC,UAAUC,GACR/K,KAAK8H,MAAM8B,SAASmB,GAItBrC,gBAEAF,WAAWtJ,GACT,OAAOc,KAAKyH,UAAUuD,SAAS9L,GAIjCyK,OACE3J,KAAKmK,mBAIP5E,UACEvF,KAAKsK,qBACLtK,KAAKwK,cAAczH,SAAQ8H,GAASA,OCrDjC,MAAMI,EAAgB,CAC3BC,eAAgB,aAChBC,WAAY,SACZC,eAAgB,OAChBC,UAAW,SACXC,eAAgB,QAGLC,EAAe,YCDrB,MAAMC,UAAetB,EAG1BpK,YAAYyJ,EAAOH,GACjBmB,MAAMhB,EAAO,CACXpF,KAAM,SACNgD,UAAW,CAAC,QAAS,YAClBiC,IAIPsB,UACE1K,KAAKyL,QAAUvF,EAASlG,KAAKyL,QAAS,KAGxC7E,SAEE,MAAQ,qOADW5G,KAAK8H,MAAMK,WAAWrB,YAAcyE,8VAmBzDG,QAAQ/E,GACN,MAAMgF,EAAUnK,EAAEmF,EAAMiF,QAEQ,WAA5BD,EAAQ3H,KAAK6H,WACEC,QAAQ,uCAGvBpG,aAAaqG,WAAW,eAAiBpH,EAAYqH,OACrDrH,WAAqB,KAEc,SAA5BgH,EAAQ3H,KAAK6H,YACtBlH,WAAqB,IAIzB8G,QAAQ9E,GACN,MAAMgF,EAAUnK,EAAEmF,EAAMiF,QJrBrB,IAA0B5H,EIsB7BhE,KAAK8K,WJtBwB9G,EIsBG2H,EAAQlL,OJrBnC,CACLoJ,KAAMZ,EACNjF,W,YIhCiB,uB,mBADRwH,G,sFCLN,MAAMS,UAAkC/B,EAC7CpK,eAAewG,GACbiE,SAASjE,GAGC,eACV,OAAOb,KAAKI,UAAU7F,KAAKoI,MAAO,KAAM,GAG1C8D,UAAUC,EAAe,IACvBnM,KAAKoI,MAAQ,IAAI+D,GAGnBC,SAASC,GACPrM,KAAKoI,MAAQ,IAAIpI,KAAKoI,SAAUiE,GAChCrM,KAAKuJ,MAAMnJ,KAAKJ,KAAKsM,WCfzB,SAASC,EAASC,EAAaC,GAC7B,OAAO,SAASC,GAEd,MAAQ,iCAEKF,KAAeE,EAAOC,OAAS,SAAW,4CAEjDF,EAAa,8BAAgC,2BACjChH,KAAKI,UAAU6G,EAAOrO,2DAEJqO,EAAOE,yBACrCH,EATS,wDASY,0BAY/B,SAASI,EAAWzE,GAClB,OAAQA,EAAK,gBACX,IAAK,aAAc,MAAO,oBAC1B,IAAK,SAAU,MAAO,uBACtB,IAAK,WAAY,MAAO,sBCxBrB,MAAM0E,UAAgBb,EAG3BnM,YAAYyJ,EAAOH,GACjBmB,MAAMhB,EAAO,CACXpF,KAAM,UACNgD,UAAW,CAAC,SACZM,UAAW,CAAC,oBACT2B,IAIPsB,UACE1K,KAAKkM,UAAUjB,GAGL,eACV,ODWG,SAAuB7C,GAC5B,MAAM2E,EAAU,CACd,CACEH,KAAM,cACND,OAAgC,SAAxBvE,EAAK,WACb/J,MAAO,CAAC8M,WAAoC,SAAxB/C,EAAK,WAA4B,SAAW,SAElE,CACEwE,KAAM,gBACND,OAA+B,WAAvBvE,EAAK,UACb/J,MAAO,CAACgN,UAAkC,WAAvBjD,EAAK,UAA6B,SAAW,WAElE,CACEwE,KAAM,uBACND,OAAoC,cAA5BvE,EAAK,eACb/J,MAAO,CAAC+M,eAA4C,cAA5BhD,EAAK,eACzB,OAAS,cAEf,CACEwE,KAAM,oBACND,OAAoC,eAA5BvE,EAAK,eACb/J,MAAO,CAAC6M,eAAgB,eAE1B,CACE0B,KAAM,uBACND,OAAoC,WAA5BvE,EAAK,eACb/J,MAAO,CAAC6M,eAAgB,WAE1B,CACE0B,KAAM,qBACND,OAAoC,aAA5BvE,EAAK,eACb/J,MAAO,CAAC6M,eAAgB,aAE1B,CACE0B,KAAMC,EAAWzE,GACjBuE,OAAoC,mBAA5BvE,EAAK,eACb/J,MAAO,CAACiN,eAA4C,mBAA5BlD,EAAK,eACzB,OAAS,oBAIjB,IAAI4E,EAAcD,EAAQvO,MAAM,EAAG,GACnCwO,EAAcA,EAAYvD,IAAI8C,EAAS,WAAWU,KAAK,IACvDD,EAAclH,EAAKkH,EAAa,MAAO,aAEvC,IAAIE,EAAeH,EAAQvO,MAAM,EAAG,GACpC0O,EAAeA,EAAazD,IAAI8C,EAAS,yBAAyBU,KAAK,IACvEC,EAAepH,EACXoH,EAAc,MACb,4BAC6B,mBAA5B9E,EAAK,eAA0C,SAAW,IAC5D,8BAEJ,IAAI+E,EAAgBJ,EAAQvO,MAAM,EAAG,GAIrC,OAHA2O,EAAgBA,EAAc1D,IAAI8C,EAAS,wBAAwB,IACnEW,EAAepH,EAAKqH,EAAgBD,EAAc,MAAO,aAElDpH,EAAKkH,EAtEJ,wCAsEoCE,EACxC,MAAO,+BCrEFE,CAAcpN,KAAKoI,OAG5BxB,SACE,OAAO5G,KAAKsM,SAGd5D,aAAaD,GACXzI,KAAKoM,SAAS3D,EAAQ4E,eAGxB3B,QAAQ/E,GACN,MAAMgF,EAAUnK,EAAEmF,EAAMiF,QAExB,GAA0B,WAAtBD,EAAQ3H,KAAK6F,KAAmB,CAClC,MAAMxL,EAAQoH,KAAKrH,MAAMuN,EAAQ3H,KAAK3F,OAChCiP,EAAc,IAAIjP,EAAWiN,eAAgB,QAEvB,aAA5BK,EAAQ3H,KAAK6H,WACP7L,KAAKoM,SAAS/N,GACd2B,KAAKoM,SAASkB,GACQ,aAA5B3B,EAAQ3H,KAAK6H,WACP7L,KAAK2K,MAAM,qBAAsBtM,GACjC2B,KAAK2K,MAAM,qBAAsB2C,M,8GAxChCR,E,YACQ,wBCHd,MAAMS,UAAgBrD,EAG3BpK,YAAYyJ,EAAOH,GACjBmB,MAAMhB,EAAO,CACXpF,KAAM,UACNgD,UAAW,CAAC,QAAS,WACrBM,UAAW,CAAC,kBACT2B,IAIPxC,SACE,MAAQ,yXAeV+C,OACEY,MAAMZ,OAEN3J,KAAKwN,SAAWxN,KAAKuJ,MAAMjH,QAAQ,YAEnCtC,KAAK4K,IAAI,gBAAgB6C,IACvBzN,KAAKwN,SAAS/M,KAAKgN,EAAMzJ,KAAK3F,UAIlCqK,cAAa,YAACgF,IACZ1N,KAAKwN,SAAS/M,KAAKiN,GAGrBjC,QAAQ9E,GACN3G,KAAK2K,MAAM,gBAAiBnJ,EAAEmF,EAAMiF,QAAQnL,QAG9CkN,UAAUhH,GACK,CAAC,QAAS,OACdqE,SAASrE,EAAMzH,OACtByH,EAAMD,iBACN1G,KAAK2K,MAAM,mB,8GAlDJ4C,E,YACQ,wB,+BCSd,SAASK,EAAOC,GACrB,OAAOC,OAAOC,aARX,GAQkCF,GAGvC,SAASG,EAAS5F,EAAOyF,GACvB,OAAQzF,EAAMwF,EAAOC,KARD,KAQ6B,KAGnD,SAASI,EAAU7F,EAAOyF,GACxB,OAAQzF,EAAMyF,IAXO,IAWqB,KAY5C,SAASK,EAAOpK,EAAKsE,GACnB,OAAO,SAAS+F,EAAGN,GACjB,MAAMlK,EAAM,GAAEG,KAAO+J,EAAQ,IACvBO,EAAYR,EAAOC,GACnBQ,EAAQL,EAAS5F,EAAMkG,SAAUT,GACjC7J,EAAOoE,EAAMmG,UAAU5K,GACvBd,EfNH,SAAwBA,EAAS,IACtC,OAAOzD,OAAO0D,KAAKD,GACd4G,KAAIvK,IAAQ,SANasP,EAMKtP,EAL5BsP,EAAIC,QAAQ,YAAaC,GAAO,IAAGA,EAAE,GAAG9N,sBAKHiC,EAAO3D,KAN9C,IAAyBsP,KAOzBvB,KAAK,MeGO0B,CAAe,IACzB1D,KACA7C,EAAMwG,YAAYjL,KAEvB,MAAQ,qGAIQG,0BACAsK,wBACDzK,2BACGK,GAAQ,uBACbnB,aAAkBwL,6BAErBjQ,OAAM4F,IAAS,iCAM7B,SAAS6K,GAAW,MAAChB,EAAD,MAAQQ,IAC1B,MAAMD,EAAYR,EAAOC,GACzB,MAAQ,yFAIQO,2BACIC,oBAEdD,gJAoCR,SAASU,EAAU/I,EAAS8H,EAAOkB,EAAUC,GAQ3C,MAAQ,4BALUA,wBAQFnB,aALa,iBAAZmB,EACV,2BAA4B,aANR,iBAAZA,EACT,GAAM,kBAAiBf,EAAUc,EAAUlB,uBAEpB,iBAAZmB,EACX,+BAAiC,aAWjCjJ,oB,wHCtHD,MAAMkJ,EAgBXnP,cACEE,KAAKkP,MAAQ,GACblP,KAAKmP,QAAU,KACfnP,KAAKoP,UAAY,KACjBpP,KAAKqP,OAAS,CACZC,KAAM,GACNC,KAAM,IAIK,kBACb,OAAOvP,KAAKkP,MAAMzF,KAAIxJ,GAAOA,EAAI0D,OAGnC6L,MAAMC,EAAOC,GAKX,OAJID,EAAQC,KACTA,EAAKD,GAAS,CAACA,EAAOC,IAGlB,IAAIpI,MAAMoI,EAAMD,EAAQ,GAC1BE,KAAK,IACLlG,KAAI,CAAC0E,EAAGN,IAAU4B,EAAQ5B,IAGjC+B,WAAWrG,EAAOtJ,EAAKqP,EAAMC,GAC3B,MAAMM,EAAetG,EAAMjH,QAAQ2M,EAAea,cAAchM,KAC1DiM,EAAexG,EAAMjH,QAAQ2M,EAAea,cAAc/L,KAEhE,QAAqB,IAAVuL,QAA0C,IAAVC,EAAuB,CAChE,MAAMS,EAAOH,EAAavN,QAAS,cAAatC,KAAKmP,QAAQnL,KAAKD,SAC5DkM,EAAOF,EAAazN,QAAS,cAAatC,KAAKmP,QAAQnL,KAAKF,SAClE9D,KAAKqP,OAAOE,KAAK5H,KAAKqI,GACtBhQ,KAAKqP,OAAOC,KAAK3H,KAAKsI,GACtBD,EAAK3M,SAAS4L,EAAe3L,WAC7B2M,EAAK5M,SAAS4L,EAAe3L,eACxB,CACL,MAAM4M,EAAQX,EACT9F,KAAI1F,GAAO8L,EAAavN,QAAS,cAAasL,EAAO7J,EAAM,UAC1DoM,EAAQb,EACT7F,KAAI3F,GAAOiM,EAAazN,QAAS,cAAawB,SACnDoM,EAAMnN,SAAQ9C,GAAOD,KAAKqP,OAAOE,KAAK5H,KAAK1H,KAC3CkQ,EAAMpN,SAAQ9C,GAAOD,KAAKqP,OAAOC,KAAK3H,KAAK1H,KAC3CiQ,EAAMnN,SAAQ9C,GAAOA,EAAIoD,SAAS4L,EAAe3L,aACjD6M,EAAMpN,SAAQ9C,GAAOA,EAAIoD,SAAS4L,EAAe3L,aAGnDtD,KAAKmP,QAAQlL,QAAQZ,SAAS4L,EAAe3L,WAG/C8M,oBACEpQ,KAAKoP,UAAU/L,SAAS4L,EAAeoB,iBAAiBC,UAG1DC,iBAAiBhH,GACfrJ,SAASsQ,YAAc/R,IACrB,MAAMwB,EAAMuB,EAAEtB,SAASuQ,iBAAiBhS,EAAEiS,MAAOjS,EAAEkS,QAC/C1Q,EAAI+D,KAAK6F,OAASoF,EAAe2B,MACnC5Q,KAAK6Q,YAAYtH,EAAOtJ,IAI5BC,SAAS4Q,UAAY,KACnB5Q,SAASsQ,YAAc,KACvBtQ,SAAS4Q,UAAY,KACE,OAAnB9Q,KAAKoP,WACPpP,KAAKoQ,qBAKXW,gBAAgBnP,EAAKoP,EAAOC,EAAQnP,EAAMoP,EAAQC,GAChDnR,KAAKoP,UAAUxM,IAAI,CACjBhB,IAAKA,EAAMsP,EAAOtP,IAAMuP,EAAOvP,IAAM,KACrCE,KAAMA,EAAOoP,EAAOpP,KAAOqP,EAAOrP,KAAO,KACzCsP,OAAQH,EAASrP,EAAM,KACvByM,MAAO2C,EAAQlP,EAAO,OAI1BuP,aAAa9H,EAAOtJ,GAClB,MAAMqR,EAAWrR,EAAI0D,IAAG,GAClB4N,EAAYvR,KAAKmP,QAAQxL,IAAG,GAC5B6N,EAAevR,EAAIwB,YACnBgQ,EAAgBzR,KAAKmP,QAAQ1N,YACnCzB,KAAKoP,UAAY7F,EAAMjH,QAAQ2M,EAAeyC,eAC9C,MAAMC,EAAkB1R,EAAIsB,QAAQ0N,EAAe2C,gBAC7CC,EAAa5R,EAAIsB,QAAQ0N,EAAe6C,WACxCC,EAAQ9R,EAAIsB,QAAQ0N,EAAe+C,UACnCd,EAASS,EAAgB3P,YACzBmP,EAAS,CACbvP,IAAK2H,EAAM5H,YAAYC,IAAMiQ,EAAWlQ,YAAYC,IACpDE,KAAMiQ,EAAMpQ,YAAYG,MAE1B9B,KAAKoP,UAAU/L,SAAS4L,EAAeoB,iBAAiB1D,QAEpD2E,EAASxN,KAAOyN,EAAUzN,KAC5BwN,EAASvN,KAAOwN,EAAUxN,IAC1B/D,KAAK+Q,gBACDS,EAAa5P,IACb4P,EAAaR,MACbS,EAAcR,OACdQ,EAAc3P,KACdoP,EACAC,GAEKG,EAASxN,KAAOyN,EAAUzN,KACnCwN,EAASvN,KAAOwN,EAAUxN,IAC1B/D,KAAK+Q,gBACDU,EAAc7P,IACd4P,EAAaR,MACbQ,EAAaP,OACbQ,EAAc3P,KACdoP,EACAC,GAEKG,EAASxN,KAAOyN,EAAUzN,KACnCwN,EAASvN,KAAOwN,EAAUxN,IAC1B/D,KAAK+Q,gBACDU,EAAc7P,IACd6P,EAAcT,MACdQ,EAAaP,OACbO,EAAa1P,KACboP,EACAC,GAEKG,EAASxN,KAAOyN,EAAUzN,KACnCwN,EAASvN,KAAOwN,EAAUxN,KAC1B/D,KAAK+Q,gBACDS,EAAa5P,IACb6P,EAAcT,MACdS,EAAcR,OACdO,EAAa1P,KACboP,EACAC,GAKRc,OAAO1I,EAAOtJ,GACZD,KAAKmP,QAAUlP,EACfD,KAAKQ,QACLR,KAAKkP,MAAMvH,KAAK1H,GAChBD,KAAK4P,WAAWrG,EAAOtJ,GAGzB4Q,YAAYtH,EAAOtJ,GACjB,MAAMqR,EAAWrR,EAAI0D,IAAG,GAClB4N,EAAYvR,KAAKmP,QAAQxL,IAAG,GAE5B2L,EAAOtP,KAAKwP,MAAM+B,EAAUzN,IAAKwN,EAASxN,KAC1CyL,EAAOvP,KAAKwP,MAAM+B,EAAUxN,IAAKuN,EAASvN,KAO1CmO,EALM5C,EAAKpM,QAAO,CAACiP,EAAKrO,KAC5ByL,EAAKxM,SAAQgB,GAAOoO,EAAIxK,KAAM,GAAE7D,KAAOC,OAChCoO,IACN,IAEgB1I,KAAI9F,GAAM4F,EAAMjH,QAAS,aAAYqB,SAExD3D,KAAKQ,QACLR,KAAKqR,aAAa9H,EAAOtJ,GACzBD,KAAKkP,MAAQgD,EACblS,KAAK4P,WAAWrG,EAAOtJ,EAAKqP,EAAMC,GAGpC/O,QACER,KAAKkP,MAAMnM,SAAQ9C,GAAOA,EAAIwD,YAAYwL,EAAe3L,aACzDtD,KAAKkP,MAAQ,GACblP,KAAKqP,OAAOC,KAAKvM,SAAQ9C,GAAOA,EAAIwD,YAAYwL,EAAe3L,aAC/DtD,KAAKqP,OAAOC,KAAO,GACnBtP,KAAKqP,OAAOE,KAAKxM,SAAQ9C,GAAOA,EAAIwD,YAAYwL,EAAe3L,aAC/DtD,KAAKqP,OAAOE,KAAO,GAEI,OAAnBvP,KAAKoP,YACPpP,KAAKoP,UAAU3L,YAAYwL,EACtBoB,iBAAiB1D,QACtB3M,KAAKoP,UAAU3L,YAAYwL,EACtBoB,iBAAiBC,WAI1B8B,WAAWpP,GACThD,KAAKkP,MAAMnM,SAAQ9C,GAAOA,EAAI2C,IAAII,M,EAtMzBiM,E,YACQ,Y,EADRA,E,gBAEa,2B,EAFbA,E,OAGG,Q,EAHHA,E,WAIQ,sB,EAJRA,E,iBAKc,4B,EALdA,E,YAMS,uB,EANTA,E,mBAOe,CACxBtC,OAAQ,0BACR2D,SAAU,8B,EATDrB,E,gBAWY,CACrBnL,IAAM,6BACNC,IAAM,+BCLH,MAAMsO,UAAcnI,EAGzBpK,YAAYyJ,EAAOH,GACjBmB,MAAMhB,EAAO,CACXpF,KAAM,QACNgD,UAAW,CAAC,YAAa,UAAW,YACjCiC,IAELpJ,KAAKsS,UAAY,CACfhD,KAAM,IACNC,KAAM,IAIV3I,SACE,OFmHG,SAAqB2L,EAAWC,EAAWpK,EAAQ,IACxD,MAAMkH,EAAO,GAQPmD,EAAc3D,EANF,IAAIxH,MAAMkL,GACvB7C,KAAK,IACLlG,IArBP,SAAuBrB,GACrB,OAAO,SAAS+F,EAAGN,GACjB,MAAO,CACLA,QAAOQ,MAAOL,EAAS5F,EAAMkG,SAAUT,KAkBlC6E,CAActK,IAClBqB,IAAIoF,GACJ5B,KAAK,IAE+B,GAAI,GAAI,gBAQ3C0F,EAlFE,wFA4EU,IAAIrL,MAAMiL,GACvB5C,KAAK,IACLlG,IArBP,SAAwBrB,GACtB,OAAO,SAAS+F,EAAGN,GACjB,MAAO,CACLA,QAAOuD,OAAQnD,EAAU7F,EAAM2G,SAAUlB,KAkBpC+E,CAAexK,IACnBqB,IArEP,SAAoBrB,GAClB,OAAO,SAAS+F,EAAGN,GAEjB,MAAQ,oGAIQA,EAAQ,8BALTI,EAAU7F,EAAM2G,SAAUlB,EAAQ,yBAQ3CA,EAAQ,yJA2DPgF,CAAWzK,IACf6E,KAAK,sBAIV,IAAK,IAAInJ,EAAM,EAAGA,GAAOyO,EAAWzO,IAAO,CACzC,MAAMgP,EAAQ,IAAIxL,MAAMkL,GACnB7C,KAAK,IACLlG,IAAIyE,EAAOpK,EAAKsE,IAChB6E,KAAK,IAEVqC,EAAK3H,KAAKmH,EAAUgE,EAAOhP,EAAKsE,EAAM2G,SAAU,QAGlD,IAAIgE,EAAOjN,EAhJH,0FAgJ4BwJ,EAAKrC,KAAK,IAC1C,MAAO,OAAQ,oBAMnB,OALA8F,EAAOjN,EAAK6M,EAAcI,EACtB,MAAO,0BAA2B,0BACtCA,EAAOjN,EAAKiN,EAAM,MAAO,uBAAwB,qBAG1CjN,EAAK2M,EAAcM,EAAM,MAAO,6BEtJ9BC,CAAYhT,KAAKsS,UAAUhD,KAAMtP,KAAKsS,UAAU/C,KACnDvP,KAAK8H,MAAMK,YAGjBuC,UACE1K,KAAKiT,eAAiB,IAAIhE,EAG5BtF,OACEY,MAAMZ,OAEN3J,KAAKkT,WAAWlT,KAAKuJ,MAAOvJ,KAAKuJ,MAAMjH,QAAQ,mBAE/CtC,KAAK4K,IAAI,iBAAiBvM,IACxB2B,KAAKiT,eAAe9D,QACfjL,UAAU,aAAc7F,GACxBoC,MAAKrC,OAAMC,IAChB2B,KAAKmT,kBAAkB9U,MAGzB2B,KAAK4K,IAAI,gBAAgB,KACvB5K,KAAKiT,eAAe9D,QAAQlL,WAG9BjE,KAAK4K,IAAI,sBAAsBvM,IXrB5B,IAAoB2F,EWsBrBhE,KAAKiT,eAAeb,WAAW/T,GAC/B2B,KAAK8K,WXvBgB9G,EWuBa,CAChC3F,QACA+U,IAAKpT,KAAKiT,eAAeI,aXxBxB,CACLxJ,KAAMd,EACN/E,aW2BFkP,WAAW3J,EAAOkE,GAChBzN,KAAKiT,eAAehB,OAAO1I,EAAOkE,GAClCzN,KAAK2K,MAAM,eAAgB8C,GAC3B,MAAM5K,EAAS4K,EAAMxK,UAAU7D,OAAO0D,KAAKmI,IAC3CjL,KAAK8K,UXxCA,CACLjB,KAAMb,EACNhF,KWsCoCnB,IAGrB,kBAAC8D,GAChB,IACE,MAAM3C,QC7DL,SAAuBuF,EAAO5C,GACnC,OAAO,IAAI2M,SAAQC,IACjB,MAAMC,EAAWhS,EAAEmF,EAAMiF,QACnB6H,EAAUD,EAASjS,QAAQ,2BAC3BL,EAAYsS,EAASxP,KAAK0P,OAC1BzD,EAAqB,QAAd/O,EAAsB,GAXvC,SAAiByF,EAAOgN,GAGtB,OAFenS,EAAEmF,EAAMiF,QAAQrK,QAAQ,uBAClBe,QAAQ,SAChBA,QAAS,cAAaqR,OAQOC,CAAQjN,EAAO8M,EAAQzP,KAAKF,KAC9D+P,EAASJ,EAAQhS,YACvB,IAAIpD,EACJ,MAAMyV,EAAeL,EAAQnR,QAAS,sBAAqBpB,OACrDgR,EAAS3I,EAAMnH,QAChB,cAAaqR,EAAQzP,KAAKD,SAEzBvB,EAAyB,QAAdtB,EAAsB,YAAc,aAC/C6S,EAAWC,OAAOP,EAAQlR,iBAC5BkR,EAAQxT,IAAKuC,GACfhE,MAAM,GAAI,IAEZ,GAAkB,QAAd0C,EAAqB,CACvB,MAAM+S,EAAc1K,EAAMhH,iBACtBgH,EAAMtJ,IAAK,UAEf6T,EAAalR,IAAI,CAACwO,OAAQ6C,IAG5B/T,SAASsQ,YAAc/R,IACrB,GAAkB,QAAdyC,EAAqB,CACvB,MAAMgT,EAAQzV,EAAEiS,MAAQmD,EAAO7C,MAC/B3S,EAAQwV,EAAOxF,MAAQ6F,EAEnB7V,GAAS0V,IACXP,EAAS5Q,IAAI,CAACoO,OAAQkD,EAAO,EAAI,OACjCJ,EAAalR,IAAI,CAACoO,MAAgB,EAARkD,EAAY,YAEnC,CACL,MAAMA,EAAQzV,EAAEkS,MAAQkD,EAAO5C,OAC/B5S,EAAQwV,EAAOzC,OAAS8C,EAEpB7V,GAAS0V,IACXP,EAAS5Q,IAAI,CAACqO,QAASiD,EAAO,EAAI,OAClCJ,EAAalR,IAAI,CAACqO,OAAiB,EAARiD,EAAY,UAK7ChU,SAAS4Q,UAAY,KACnB5Q,SAASsQ,YAAc,KACvBtQ,SAAS4Q,UAAY,KAEH,QAAd5P,GACE7C,GAAS0V,EACX7B,EAAOnP,SAAQ0B,GAAMA,EAAGzB,MAAMqL,MAAQhQ,EAAQ,OAE9C6T,EAAOnP,SAAQ0B,GAAMA,EAAGzB,MAAMqL,MAAQ0F,EAAW,OAGnDP,EAAS5Q,IAAI,CAACoO,MAAO,SACrB8C,EAAalR,IAAI,CAACoO,MAAO,UAErB3S,GAAS0V,GACXN,EAAQ7Q,IAAI,CAACwO,OAAQ/S,EAAQ,OAC7B4R,EAAKrN,IAAI,CAACwO,OAAQ/S,EAAQ,SAE1BoV,EAAQ7Q,IAAI,CAACwO,OAAQ2C,EAAW,OAChC9D,EAAKrN,IAAI,CAACwO,OAAQ2C,EAAW,QAG/BP,EAAS5Q,IAAI,CAACqO,OAAQ,SACtB6C,EAAalR,IAAI,CAACqO,OAAQ,SAG5BsC,EAAQ,CACNlV,MAAOA,EAAQ0V,EAAW1V,EAAQ0V,EAClC7S,YACAyC,GAAI8P,EAAQzP,KAAK9C,SDZAiT,CAAcnU,KAAKuJ,MAAO5C,GAC7C3G,KAAK8K,UX7DJ,SAAqB9G,GAC1B,MAAO,CACL6F,KAAMhB,EACN7E,QW0DiBoQ,CAAoBpQ,IACnC,MAAOvF,GACP4V,QAAQC,KAAK,eAAgB7V,EAAE8V,UAInCC,YAAY7N,IE5EP,SAAsBA,GAC3B,OAAOA,EAAMiF,OAAOzJ,QAAQuR,OF4EtBe,CAAa9N,GEzEd,SAAgBA,GACrB,MAAqC,SAA9BA,EAAMiF,OAAOzJ,QAAQ0H,KF0Ef6K,CAAO/N,KACZA,EAAMgO,UACR3U,KAAKiT,eAAepC,YAAY7Q,KAAKuJ,MAAO/H,EAAEmF,EAAMiF,SACpD5L,KAAKiT,eAAe7C,sBAEpBpQ,KAAKkT,WAAWlT,KAAKuJ,MAAO/H,EAAEmF,EAAMiF,SACpC5L,KAAKiT,eAAe1C,iBAAiBvQ,KAAKuJ,SAP5CvJ,KAAK4U,YAAYjO,GAYrBgH,UAAUhH,GACR,MASM,IAACzH,GAAOyH,EAEd,GAXa,CACX,QACA,MACA,UACA,YACA,YACA,cAKOqE,SAAS9L,KAASyH,EAAMgO,SAAU,CACzChO,EAAMD,iBACN,MAAM/C,EAAK3D,KAAKiT,eAAe9D,QAAQxL,IAAG,GACpCkR,EAAQ7U,KAAKuJ,MAAMjH,QEjGxB,SAAsBpD,GAAK,IAAC4E,EAAD,IAAMC,IAAM,KAACuL,EAAD,KAAOC,IAGnD,OAAQrQ,GACN,IAAK,QACH4E,EAAMA,EAAM,EAAIwL,EAAOxL,EAAM,EAAIwL,EACjC,MACF,IAAK,MAAOvL,IACV,MACF,IAAK,UACHD,EAAMA,EAAM,EATE,IAS0BA,EAAM,EAC9C,MACF,IAAK,YACHA,EAAMA,EAAM,EAAIwL,EAAOxL,EAAM,EAAIwL,EACjC,MACF,IAAK,YACHvL,EAAMA,EAAM,EAfE,IAe0BA,EAAM,EAC9C,MACF,IAAK,aACHA,EAAMA,EAAM,EAAIwL,EAAOxL,EAAM,EAAIwL,EAIrC,MAAQ,aAAYzL,KAAOC,MF0EU+Q,CAAa5V,EAAKyE,EAAI3D,KAAKsS,YAC5DtS,KAAKkT,WAAWlT,KAAKuJ,MAAOsL,GAC5B7U,KAAK2K,MAAM,eAAgBkK,IAI/B1B,kBAAkB9U,GX/Fb,IAAoB2F,EWgGvBhE,KAAK8K,WXhGkB9G,EWgGW,CAChCL,GAAI3D,KAAKiT,eAAe9D,QAAQxL,KAChCtF,SXjGG,CACLwL,KAAMf,EACN9E,UWmGFyH,QAAQ9E,GACN3G,KAAKmT,kBAAkB3R,EAAEmF,EAAMiF,QAAQnL,SG9GpC,SAASsU,EAAY3M,EAAO2C,GACjC,IAAIiK,EACAC,EAEJ,OAAQlK,EAAOlB,MACb,KAAKhB,EAEH,OADAmM,EAAkC,QAA1BjK,EAAO/G,KAAK9C,UAAsB,WAAa,WAChD,IAAIkH,EAAO,CAAC4M,GAAQE,EAAS9M,EAAO4M,EAAOjK,IACpD,KAAKjC,EAEH,OADAkM,EAAQ,YACD,IACF5M,EACHsF,YAAa3C,EAAO/G,KAAK3F,MACzB,CAAC2W,GAAQE,EAAS9M,EAAO4M,EAAOjK,IAEpC,KAAK/B,EACH,MAAO,IAAIZ,EAAOiF,cAAetC,EAAO/G,MAC1C,KAAK+E,EAMH,OALAiM,EAAQ,cACRC,EAAM7M,EAAM4M,IAAU,GACtBjK,EAAO/G,KAAKoP,IAAIrQ,SAAQY,IACtBsR,EAAItR,GAAM,IAAIsR,EAAItR,MAAQoH,EAAO/G,KAAK3F,UAEjC,IACF+J,EACH,CAAC4M,GAAQC,EACT5H,cAAe,IAAIjF,EAAMiF,iBAAkBtC,EAAO/G,KAAK3F,QAE3D,KAAK4K,EACH,MAAO,IAAIb,EAAOtB,WAAYiE,EAAO/G,MACvC,KAAKkF,EACH,MAAO,IAAId,EAAOrB,gBAAgB,IAAI9B,MAAOkQ,UAC/C,QAAS,OAAO/M,GAIpB,SAAS8M,EAAS9M,EAAO4M,EAAOjK,GAC9B,MAAM1M,EAAQ+J,EAAM4M,IAAU,GAE9B,OADA3W,EAAM0M,EAAO/G,KAAKL,IAAMoH,EAAO/G,KAAK3F,MAC7BA,G,8GHrCIgU,E,YACQ,sBITrB,MAAM+C,EAAe,CACnBtO,WAAYyE,EACZwD,SAAU,GACVT,SAAU,GACVC,UAAW,GACXK,YAAa,GACblB,YAAa,GACbL,cAAepC,EACflE,gBAAgB,IAAI9B,MAAOkQ,UCTtB,MAAME,EACXvV,YAAYwV,EAAQC,EAAQ,KAC1BvV,KAAKsV,OAASA,EACdtV,KAAKwV,OAAStP,EAASlG,KAAKwV,OAAOnL,KAAKrK,MAAOuV,GAGjDC,OAAOpN,GACLpI,KAAKsV,OAAOG,KAAKrN,GAGnB7I,MACE,OAAOS,KAAKsV,OAAO/V,OCPhB,MAAMmW,EACX5V,YAAYqE,GACVnE,KAAKmE,KALA,eAKmBA,EAG1BsR,KAAKrN,GAEH,OADA5C,EAAQxF,KAAKmE,KAAMiE,GACZkL,QAAQC,UAGjBhU,MACE,OAAO,IAAI+T,SAAQC,IACjB,MAAMnL,EAAQ5C,EAAQxF,KAAKmE,MAE3BqC,YAAW,KACT+M,EAAQnL,KACP,SCjBT,ICDO,MACLtI,YAAYC,EAAU4V,GACpB,IAAK5V,EACH,MAAM,IAAIsF,MAAM,uCAGlBrF,KAAK4V,aAAepU,EAAEzB,GACtBC,KAAK2V,OAASA,EACd3V,KAAK6V,OAAS,IAAIvR,EAClBtE,KAAK8V,KAAO,KACZ9V,KAAK+V,kBAAoB/V,KAAK+V,kBAAkB1L,KAAKrK,MAErDA,KAAK2J,OAGPA,OACEjH,OAAOtB,iBAAiB,aAAcpB,KAAK+V,mBAC3C/V,KAAK+V,oBAGgB,0BACjB/V,KAAK8V,MACP9V,KAAK8V,KAAKvQ,UAGZvF,KAAK4V,aAAapV,QAAQK,OAAOb,KAAK6V,QAEtC,MAAM9Q,EAAOJ,EAAYG,KAAKkG,SAAS,eACjChL,KAAK2V,OAAOK,YACZhW,KAAK2V,OAAOM,UAElBjW,KAAK8V,KAAO,IAAI/Q,EAAKJ,EAAYqH,OAEjC,MAAMkK,QAAalW,KAAK8V,KAAK1Q,UAC7BpF,KAAK4V,aAAapV,QAAQK,OAAOqV,GAEjClW,KAAK8V,KAAKxQ,cAGZC,UACE7C,OAAOpB,oBAAoB,aAActB,KAAK+V,qBDvCvC,OAAQ,CACjBE,UEFK,cAA4BlR,EACjCK,UACE,MAAMF,EAAMD,KAAKC,MAAMC,WACvB,OAAO3D,EAAE+C,OAAO,MAAO,aAAanE,KAAM,oGAEY8E,6NzByBnD,WACL,MAAMpC,EAjBR,WACE,MAAMA,EAAO,GAEb,IAAK,IAAIqT,EAAI,EAAGA,EAAIzQ,aAAa0Q,OAAQD,IAAK,CAC5C,MAAMjX,EAAMwG,aAAaxG,IAAIiX,GAExBjX,EAAI8L,SAAS,gBAIlBlI,EAAK6E,KAAKzI,GAGZ,OAAO4D,EAIMuT,GAEb,OAAKvT,EAAKsT,OAMF,2CAEJtT,EAAK2G,IAAI7C,GAAQqG,KAAK,mBAPhB,0FyBvBJqJ,cFRNN,YGKK,cAA8BjR,EACnCjF,YAAYkM,GACVzB,MAAMyB,GAENhM,KAAKyK,SAAW,KAChBzK,KAAKuW,UAAY,IAAIlB,EACjB,IAAIK,EAAmB1V,KAAKgF,SAIrB,gBACX,MACM8C,ECxBH,SAAqBiN,EAAa5I,EAAe,IACtD,IAAI/D,EAAQ2M,EAAY,IAAI5I,GAAe,CAACtC,KAAM,aAC9C1C,EAAY,GAEhB,MAAO,CACLM,UAAUC,IACRP,EAAUQ,KAAKD,GACR,CACLkB,cACEzB,EAAYA,EAAUS,QAAOJ,GAAYA,IAAaE,OAI5DkC,SAASmB,GACP3C,EAAQ2M,EAAY3M,EAAO2C,GAC3B5D,EAAUpE,SAAQyE,GAAYA,EAASY,MAEzCD,SAAQ,IACC1C,KAAKrH,MAAMqH,KAAKI,UAAUuC,KDMrBoO,CAAYzB,GNJQ3M,QMGdpI,KAAKuW,UAAUhX,ONTrB6I,KAAS,IACtBA,EACHiF,cAAepC,EACfyC,YAAa,KAIE+I,CAAUrO,GrBgCpB,SAAe5I,GACpB,OAAOiG,KAAKrH,MAAMqH,KAAKI,UAAUrG,IqBjCCkX,CAAMtB,IADnC,IAA+BhN,EMalC,OAPApI,KAAKyK,SAAW3C,EAAML,UAAUzH,KAAKuW,UAAUf,QAE/CxV,KAAKgW,YAAc,IAAI7M,EAAY,CACjCjB,WAAY,CAACsD,EAAQsB,EAASS,EAAS8E,GACvCvK,UAGK9H,KAAKgW,YAAY5Q,UAG1BE,cACEtF,KAAKgW,YAAYrM,OAGnBpE,UACEvF,KAAKgW,YAAYzQ,UACjBvF,KAAKyK,SAAS7B,mB","file":"bundle.js","sourcesContent":["export function parse(value = '') {\r\n  if (value.startsWith('=')) {\r\n    try {\r\n      return eval(value.slice(1))\r\n    } catch (e) {\r\n      return value\r\n    }\r\n  }\r\n  return value\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","class Dom {\r\n  constructor(selector) {\r\n    this.$el = typeof selector === 'string'\r\n      ? document.querySelector(selector)\r\n      : selector\r\n  }\r\n\r\n  html(html) {\r\n    if (typeof html === 'string') {\r\n      this.$el.innerHTML = html\r\n      return this\r\n    }\r\n    return this.$el.outerHTML.trim()\r\n  }\r\n\r\n  clear() {\r\n    this.html('')\r\n    return this\r\n  }\r\n\r\n  text(text) {\r\n    if (typeof text === 'string' || typeof text === 'number') {\r\n      this.$el.textContent = text\r\n      return this\r\n    }\r\n    if (this.$el.tagName.toLowerCase() === 'input') {\r\n      return this.$el.value.trim()\r\n    }\r\n    return this.$el.textContent.trim()\r\n  }\r\n\r\n  append(node) {\r\n    if (node instanceof Dom) {\r\n      node = node.$el\r\n    }\r\n    if (Element.prototype.append) {\r\n      this.$el.append(node)\r\n    } else {\r\n      this.$el.appendChild(node)\r\n    }\r\n  }\r\n\r\n  on(eventType, callback) {\r\n    this.$el.addEventListener(eventType, callback)\r\n  }\r\n\r\n  off(eventType, callback) {\r\n    this.$el.removeEventListener(eventType, callback)\r\n  }\r\n\r\n  closest(selector) {\r\n    return $(this.$el.closest(selector))\r\n  }\r\n\r\n  getCoords() {\r\n    return this.$el.getBoundingClientRect()\r\n  }\r\n\r\n  getOffset() {\r\n    return {\r\n      top: this.$el.offsetTop,\r\n      left: this.$el.offsetLeft\r\n    }\r\n  }\r\n\r\n  getScroll() {\r\n    return {\r\n      top: this.$el.scrollTop,\r\n      left: this.$el.scrollLeft\r\n    }\r\n  }\r\n\r\n  get data() {\r\n    return this.$el.dataset\r\n  }\r\n\r\n  findAll(selector) {\r\n    return this.$el.querySelectorAll(selector)\r\n  }\r\n\r\n  findDom(selector) {\r\n    return $(this.$el.querySelector(selector))\r\n  }\r\n\r\n  getPropertyValue(selector, property, pseudoElement) {\r\n    return window.getComputedStyle(selector, pseudoElement)\r\n        .getPropertyValue(property)\r\n  }\r\n\r\n  css(styles = {}) {\r\n    Object.keys(styles).forEach(key => {\r\n      this.$el.style[key] = styles[key]\r\n    })\r\n  }\r\n\r\n  getStyles(styles = []) {\r\n    return styles.reduce((res, s) => {\r\n      res[s] = this.$el.style[s]\r\n      return res\r\n    }, {})\r\n  }\r\n\r\n  addClass(className) {\r\n    this.$el.classList.add(className)\r\n  }\r\n\r\n  removeClass(className) {\r\n    this.$el.classList.remove(className)\r\n  }\r\n\r\n  id(parse) {\r\n    if (parse) {\r\n      const parsed = this.id().split(':')\r\n      return {\r\n        row: +parsed[0],\r\n        col: +parsed[1]\r\n      }\r\n    }\r\n    return this.data.id\r\n  }\r\n\r\n  focus() {\r\n    this.$el.focus()\r\n    return this\r\n  }\r\n\r\n  attribute(name, value) {\r\n    if (value) {\r\n      this.$el.setAttribute(name, value)\r\n      return this\r\n    }\r\n    return this.$el.getAttribute(name)\r\n  }\r\n}\r\n\r\nexport function $(selector) {\r\n  return new Dom(selector)\r\n}\r\n\r\n$.create = (tagName, classes = '') => {\r\n  const el = document.createElement(tagName)\r\n  if (classes) {\r\n    el.classList.add(classes)\r\n  }\r\n  return $(el)\r\n}\r\n","import {$} from '@core/dom'\r\n\r\nexport function Loader() {\r\n  return $.create('div', 'loader').html(`\r\n    <div class=\"lds-default\">\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n      <div></div>\r\n    </div>\r\n  `)\r\n}\r\n","export class ActiveRoute {\r\n  static get path() {\r\n    return window.location.hash.slice(1)\r\n  }\r\n\r\n  static get param() {\r\n    return ActiveRoute.path.split('/')[1]\r\n  }\r\n\r\n  static navigate(path) {\r\n    window.location.hash = path\r\n  }\r\n}\r\n","export class Page {\r\n  constructor(params) {\r\n    this.params = params || Date.now().toString()\r\n  }\r\n\r\n  getRoot() {\r\n    throw new Error('Method \"getRoot\" should be implemented')\r\n  }\r\n\r\n  afterRender() {}\r\n\r\n  destroy() {}\r\n}\r\n","export function capitalize(string) {\r\n  if (typeof string !== 'string') {\r\n    return ''\r\n  }\r\n  return string.charAt(0).toUpperCase() + string.slice(1)\r\n}\r\n\r\nexport function storage(key, data = null) {\r\n  if (!data) {\r\n    return JSON.parse(localStorage.getItem(key))\r\n  }\r\n  localStorage.setItem(key, JSON.stringify(data))\r\n}\r\n\r\nexport function isEqual(a, b) {\r\n  if (typeof a === 'object' && typeof b === 'object') {\r\n    return JSON.stringify(a) === JSON.stringify(b)\r\n  }\r\n  return a === b\r\n}\r\n\r\nexport function wrap(content, wrapperTag, wrapperClass, data) {\r\n  const elData = typeof(data) === 'undefined' ? '' : data\r\n  return `\r\n  <${wrapperTag} class=\"${wrapperClass}\" ${elData}>\r\n    ${content}\r\n  </${wrapperTag}>\r\n  `\r\n}\r\n\r\nexport function camelToDashCase(str) {\r\n  return str.replace(/([A-Z])/g, (g) => `-${g[0].toLowerCase()}`)\r\n}\r\n\r\nexport function toInlineStyles(styles = {}) {\r\n  return Object.keys(styles)\r\n      .map(key => `${camelToDashCase(key)}: ${styles[key]}`)\r\n      .join('; ')\r\n}\r\n\r\nexport function debounce(fn, wait) {\r\n  let timeout\r\n  return function(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout)\r\n      // eslint-disable-next-line\r\n      fn.apply(this, args)\r\n    }\r\n    clearTimeout(timeout)\r\n    timeout = setTimeout(later, wait)\r\n  }\r\n}\r\n\r\nexport function clone(obj) {\r\n  return JSON.parse(JSON.stringify(obj))\r\n}\r\n\r\nexport function preventDefault(event) {\r\n  event.preventDefault()\r\n}\r\n","import {storage} from '@core/utils'\r\n\r\nexport function toHTML(key) {\r\n  const model = storage(key)\r\n  const id = key.split(':')[1]\r\n  return `\r\n  <li class=\"spreadsheets-list__item\">\r\n    <a class=\"spreadsheets-list__item__link\" href=\"#spreadsheet/${id}\">\r\n      <span class=\"spreadsheets-list__item__name\">${model.tableTitle}</span>\r\n      <span class=\"spreadsheets-list__item__date\">\r\n        ${new Date(model.lastOpenedDate).toLocaleDateString()}\r\n        ${new Date(model.lastOpenedDate).toLocaleTimeString()}\r\n      </span>\r\n    </a>\r\n  </li>\r\n  `\r\n}\r\n\r\nfunction getAllKeys() {\r\n  const keys = []\r\n\r\n  for (let i = 0; i < localStorage.length; i++) {\r\n    const key = localStorage.key(i)\r\n\r\n    if (!key.includes('spreadsheet')) {\r\n      continue\r\n    }\r\n\r\n    keys.push(key)\r\n  }\r\n\r\n  return keys\r\n}\r\n\r\nexport function createSpreadsheetsTable() {\r\n  const keys = getAllKeys()\r\n\r\n  if (!keys.length) {\r\n    return `\r\n    <p class=\"no-spreadsheets\">You still have not created any spreadsheets.</p>\r\n    `\r\n  }\r\n\r\n  return `\r\n  <ul class=\"spreadsheets-list\">\r\n    ${keys.map(toHTML).join('')}\r\n  </ul>\r\n  `\r\n}\r\n","export class Emitter {\r\n  constructor() {\r\n    this.listeners = {}\r\n  }\r\n\r\n  // Inform listeners if there are any\r\n  // component.emit('table:select', {A: 1})\r\n  emit(eventName, ...args) {\r\n    if (!Array.isArray(this.listeners[eventName])) {\r\n      return false\r\n    }\r\n    this.listeners[eventName].forEach(listener => {\r\n      listener(...args)\r\n    })\r\n    return true\r\n  }\r\n\r\n  // Subscribe to notification / add new listener\r\n  // component.subscribe('table:select', (callback) => {})\r\n  subscribe(eventName, func) {\r\n    this.listeners[eventName] = this.listeners[eventName] || []\r\n    this.listeners[eventName].push(func)\r\n    return () => {\r\n      this.listeners[eventName] = this.listeners[eventName]\r\n          .filter(listener => listener !== func)\r\n    }\r\n  }\r\n}\r\n","import {isEqual} from '@core/utils'\r\n\r\nexport class StoreSubscriber {\r\n  constructor(store) {\r\n    this.store = store\r\n    this.sub = null\r\n    this.prevState = {}\r\n  }\r\n\r\n  subscribeComponents(components) {\r\n    this.prevState = this.store.getState()\r\n\r\n    this.sub = this.store.subscribe(state => {\r\n      Object.keys(state).forEach(key => {\r\n        if (!isEqual(this.prevState[key], state[key])) {\r\n          components.forEach(component => {\r\n            if (component.isWatching(key)) {\r\n              const changes = {[key]: state[key]}\r\n              component.storeChanged(changes)\r\n            }\r\n          })\r\n        }\r\n      })\r\n\r\n      this.prevState = this.store.getState()\r\n    })\r\n  }\r\n\r\n  unsubscribeFromStore() {\r\n    this.sub.unsubscribe()\r\n  }\r\n}\r\n","export const TABLE_RESIZE = 'TABLE_RESIZE'\r\nexport const CHANGE_TEXT = 'CHANGE_TEXT'\r\nexport const APPLY_STYLE = 'APPLY_STYLE'\r\nexport const CHANGE_STYLES = 'CHANGE_STYLES'\r\nexport const CHANGE_TITLE = 'CHANGE_TITLE'\r\nexport const UPDATE_DATE = 'UPDATE_DATE'\r\n","import {$} from '@core/dom'\r\nimport {Emitter} from '@core/Emitter'\r\nimport {StoreSubscriber} from '@core/StoreSubscriber'\r\nimport {updateDate} from '@/redux/actions'\r\nimport {preventDefault} from '@core/utils'\r\n\r\nexport class Spreadsheet {\r\n  constructor(options) {\r\n    this.components = options.components || []\r\n    this.store = options.store\r\n    this.emitter = new Emitter()\r\n    this.subscriber = new StoreSubscriber(this.store)\r\n  }\r\n\r\n  getRoot() {\r\n    const $root = $.create('div', 'spreadsheet')\r\n\r\n    const componentOptions = {\r\n      emitter: this.emitter,\r\n      store: this.store\r\n    }\r\n\r\n    this.components = this.components.map(Component => {\r\n      const $el = $.create('div', Component.className)\r\n      const component = new Component($el, componentOptions)\r\n      $el.html(component.toHTML())\r\n      $root.append($el)\r\n      return component\r\n    })\r\n\r\n    return $root\r\n  }\r\n\r\n  init() {\r\n    if (process.env.NODE_ENV === 'production') {\r\n      document.addEventListener('contextmenu', preventDefault)\r\n    }\r\n    this.store.dispatch(updateDate())\r\n    this.subscriber.subscribeComponents(this.components)\r\n    this.components.forEach(component => component.init())\r\n  }\r\n\r\n  destroy() {\r\n    this.subscriber.unsubscribeFromStore()\r\n    this.components.forEach(component => component.destroy())\r\n    document.removeEventListener('contextmenu', preventDefault)\r\n  }\r\n}\r\n","import {\r\n  CHANGE_TEXT,\r\n  CHANGE_STYLES,\r\n  TABLE_RESIZE,\r\n  APPLY_STYLE,\r\n  CHANGE_TITLE,\r\n  UPDATE_DATE\r\n} from './types'\r\n\r\nexport function tableResize(data) {\r\n  return {\r\n    type: TABLE_RESIZE,\r\n    data\r\n  }\r\n}\r\n\r\nexport function changeText(data) {\r\n  return {\r\n    type: CHANGE_TEXT,\r\n    data\r\n  }\r\n}\r\n\r\nexport function changeStyles(data) {\r\n  return {\r\n    type: CHANGE_STYLES,\r\n    data\r\n  }\r\n}\r\n\r\nexport function applyStyle(data) {\r\n  return {\r\n    type: APPLY_STYLE,\r\n    data\r\n  }\r\n}\r\n\r\nexport function changeTableTitle(data) {\r\n  return {\r\n    type: CHANGE_TITLE,\r\n    data\r\n  }\r\n}\r\n\r\nexport function updateDate() {\r\n  return {\r\n    type: UPDATE_DATE\r\n  }\r\n}\r\n","import {capitalize} from '@core/utils'\r\n\r\nexport class DomListener {\r\n  constructor($root, listeners = []) {\r\n    if (!$root) {\r\n      throw new Error(`No $root provided for DomListener!`)\r\n    }\r\n    this.$root = $root\r\n    this.listeners = listeners\r\n  }\r\n\r\n  initDOMListeners() {\r\n    this.listeners.forEach(listener => {\r\n      const method = getMethodName(listener)\r\n      if (!this[method]) {\r\n        const name = this.name\r\n        throw new Error(\r\n            `Method ${method} is not implemented in ${name} component`\r\n        )\r\n      }\r\n      this[method] = this[method].bind(this)\r\n      this.$root.on(listener, this[method])\r\n    })\r\n  }\r\n\r\n  removeDOMListeners() {\r\n    this.listeners.forEach(listener => {\r\n      const method = getMethodName(listener)\r\n      if (this[method]) {\r\n        this.$root.off(listener, this[method])\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction getMethodName(eventName) {\r\n  return 'on' + capitalize(eventName)\r\n}\r\n","import {DomListener} from '@core/DomListener'\r\n\r\nexport class SpreadsheetComponent extends DomListener {\r\n  constructor($root, options = {}) {\r\n    super($root, options.listeners)\r\n    this.name = options.name || ''\r\n    this.emitter = options.emitter\r\n    this.subscribe = options.subscribe || []\r\n    this.unsubscribers = []\r\n    this.store = options.store\r\n    this.storeSub = null\r\n\r\n    this.prepare()\r\n  }\r\n\r\n  // Set up component before init\r\n  prepare() {}\r\n\r\n  // Returns component template\r\n  toHTML() {\r\n    return ''\r\n  }\r\n\r\n  // Inform listeners about event\r\n  $emit(event, ...args) {\r\n    this.emitter.emit(event, ...args)\r\n  }\r\n\r\n  // Subscribe to event\r\n  $on(event, func) {\r\n    const unsub = this.emitter.subscribe(event, func)\r\n    this.unsubscribers.push(unsub)\r\n  }\r\n\r\n  $dispatch(action) {\r\n    this.store.dispatch(action)\r\n  }\r\n\r\n  // Only changes in the fields that we subscribed to, comes here\r\n  storeChanged() {}\r\n\r\n  isWatching(key) {\r\n    return this.subscribe.includes(key)\r\n  }\r\n\r\n  // Init component, add DOM listeners\r\n  init() {\r\n    this.initDOMListeners()\r\n  }\r\n\r\n  // Delete component, clear listeners\r\n  destroy() {\r\n    this.removeDOMListeners()\r\n    this.unsubscribers.forEach(unsub => unsub())\r\n  }\r\n}\r\n","export const defaultStyles = {\r\n  justifyContent: 'flex-start',\r\n  fontWeight: 'normal',\r\n  textDecoration: 'none',\r\n  fontStyle: 'normal',\r\n  activeDropDown: 'none'\r\n}\r\n\r\nexport const defaultTitle = 'New Table'\r\n","import {SpreadsheetComponent} from '@core/SpreadsheetComponent'\r\nimport {$} from '@core/dom'\r\nimport {changeTableTitle} from '@/redux/actions';\r\nimport {defaultTitle} from '@/constants'\r\nimport {debounce} from '@core/utils'\r\nimport {ActiveRoute} from '@core/routes/ActiveRoute'\r\n\r\nexport class Header extends SpreadsheetComponent {\r\n  static className = 'spreadsheet__header'\r\n\r\n  constructor($root, options) {\r\n    super($root, {\r\n      name: 'Header',\r\n      listeners: ['input', 'click'],\r\n      ...options\r\n    })\r\n  }\r\n\r\n  prepare() {\r\n    this.onInput = debounce(this.onInput, 250)\r\n  }\r\n\r\n  toHTML() {\r\n    const tableTitle = this.store.getState().tableTitle || defaultTitle\r\n    return `\r\n      <div class=\"spreadsheet__header__inner\">\r\n        <a class=\"logo\" href=\"#dashboard\">\r\n          <img src=\"logo.png\" alt=\"Spreadsheet\" class=\"img\" />\r\n        </a>\r\n        <input class=\"title-input\" type=\"text\" value=\"${tableTitle}\">\r\n        <div class=\"control-panel\">\r\n          <div class=\"button\" data-button-type=\"delete\">\r\n            <span class=\"material-icons\"> delete </span>\r\n          </div>\r\n          <div class=\"button\" data-button-type=\"exit\">\r\n            <span class=\"material-icons\"> exit_to_app </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `\r\n  }\r\n\r\n  onClick(event) {\r\n    const $target = $(event.target)\r\n\r\n    if ($target.data.buttonType === 'delete') {\r\n      const decision = confirm('Do you want to delete this table?')\r\n\r\n      if (decision) {\r\n        localStorage.removeItem('spreadsheet:' + ActiveRoute.param)\r\n        ActiveRoute.navigate('')\r\n      }\r\n    } else if ($target.data.buttonType === 'exit') {\r\n      ActiveRoute.navigate('')\r\n    }\r\n  }\r\n\r\n  onInput(event) {\r\n    const $target = $(event.target)\r\n    this.$dispatch(changeTableTitle($target.text()))\r\n  }\r\n}\r\n","import {SpreadsheetComponent} from '@core/SpreadsheetComponent'\r\n\r\nexport class SpreadsheetStateComponent extends SpreadsheetComponent {\r\n  constructor(...args) {\r\n    super(...args)\r\n  }\r\n\r\n  get template() {\r\n    return JSON.stringify(this.state, null, 2)\r\n  }\r\n\r\n  initState(initialState = {}) {\r\n    this.state = {...initialState}\r\n  }\r\n\r\n  setState(newState) {\r\n    this.state = {...this.state, ...newState}\r\n    this.$root.html(this.template)\r\n  }\r\n}\r\n","import {wrap} from '@core/utils'\r\n\r\nfunction toButton(buttonClass, isDropDown) {\r\n  return function(button) {\r\n    const arrow = `<span class=\"material-icons\"> arrow_drop_down </span>`\r\n    return `\r\n      <div \r\n        class=\"${buttonClass} ${button.active ? 'active' : ''}\"\r\n        data-type=\"button\"\r\n        ${isDropDown ? 'data-button-type=\"dropdown\"' : ''}\r\n        data-value='${JSON.stringify(button.value)}'\r\n      >\r\n        <span class=\"material-icons\"> ${button.icon} </span>\r\n        ${isDropDown ? arrow : ''}\r\n      </div>\r\n    `\r\n  }\r\n}\r\n\r\nfunction insertDivider() {\r\n  return `\r\n  <span class=\"divider\"></span>\r\n  `\r\n}\r\n\r\nfunction whichAlign(state) {\r\n  switch (state['justifyContent']) {\r\n    case 'flex-start': return 'format_align_left'\r\n    case 'center': return 'format_align_justify'\r\n    case 'flex-end': return 'format_align_right'\r\n  }\r\n}\r\n\r\nexport function createToolbar(state) {\r\n  const buttons = [\r\n    {\r\n      icon: 'format_bold',\r\n      active: state['fontWeight'] === 'bold',\r\n      value: {fontWeight: state['fontWeight'] === 'bold' ? 'normal' : 'bold'}\r\n    },\r\n    {\r\n      icon: 'format_italic',\r\n      active: state['fontStyle'] === 'italic',\r\n      value: {fontStyle: state['fontStyle'] === 'italic' ? 'normal' : 'italic'}\r\n    },\r\n    {\r\n      icon: 'format_strikethrough',\r\n      active: state['textDecoration'] === 'underline',\r\n      value: {textDecoration: state['textDecoration'] === 'underline'\r\n        ? 'none' : 'underline'}\r\n    },\r\n    {\r\n      icon: 'format_align_left',\r\n      active: state['justifyContent'] === 'flex-start',\r\n      value: {justifyContent: 'flex-start'}\r\n    },\r\n    {\r\n      icon: 'format_align_justify',\r\n      active: state['justifyContent'] === 'center',\r\n      value: {justifyContent: 'center'}\r\n    },\r\n    {\r\n      icon: 'format_align_right',\r\n      active: state['justifyContent'] === 'flex-end',\r\n      value: {justifyContent: 'flex-end'}\r\n    },\r\n    {\r\n      icon: whichAlign(state),\r\n      active: state['activeDropDown'] === 'justifyContent',\r\n      value: {activeDropDown: state['activeDropDown'] === 'justifyContent'\r\n        ? 'none' : 'justifyContent'}\r\n    }\r\n  ]\r\n\r\n  let fontButtons = buttons.slice(0, 3)\r\n  fontButtons = fontButtons.map(toButton('button')).join('')\r\n  fontButtons = wrap(fontButtons, 'div', 'edit-tool')\r\n\r\n  let alignButtons = buttons.slice(3, 6)\r\n  alignButtons = alignButtons.map(toButton('button button--align')).join('')\r\n  alignButtons = wrap(\r\n      alignButtons, 'div',\r\n      `edit-tool--align\r\n      ${state['activeDropDown'] === 'justifyContent' ? 'active' : ''}`,\r\n      'data-type=\"drop-down-menu\"'\r\n  )\r\n  let alignDropDown = buttons.slice(6, 7)\r\n  alignDropDown = alignDropDown.map(toButton('button button--align', true))\r\n  alignButtons = wrap(alignDropDown + alignButtons, 'div', 'edit-tool')\r\n\r\n  return wrap(fontButtons + insertDivider() + alignButtons,\r\n      'div', 'spreadsheet__toolbar__inner')\r\n}\r\n","import {SpreadsheetStateComponent} from '@core/SpreadsheetStateComponent'\r\nimport {$} from '@core/dom'\r\nimport {createToolbar} from '@/components/toolbar/toolbar.template'\r\nimport {defaultStyles} from '@/constants'\r\n\r\nexport class Toolbar extends SpreadsheetStateComponent {\r\n  static className = 'spreadsheet__toolbar'\r\n\r\n  constructor($root, options) {\r\n    super($root, {\r\n      name: 'Toolbar',\r\n      listeners: ['click'],\r\n      subscribe: ['currentStyles'],\r\n      ...options\r\n    })\r\n  }\r\n\r\n  prepare() {\r\n    this.initState(defaultStyles)\r\n  }\r\n\r\n  get template() {\r\n    return createToolbar(this.state)\r\n  }\r\n\r\n  toHTML() {\r\n    return this.template\r\n  }\r\n\r\n  storeChanged(changes) {\r\n    this.setState(changes.currentStyles)\r\n  }\r\n\r\n  onClick(event) {\r\n    const $target = $(event.target)\r\n\r\n    if ($target.data.type === 'button') {\r\n      const value = JSON.parse($target.data.value)\r\n      const mergedValue = {...value, ...{activeDropDown: 'none'}}\r\n\r\n      $target.data.buttonType === 'dropdown'\r\n          ? this.setState(value)\r\n          : this.setState(mergedValue)\r\n      $target.data.buttonType === 'dropdown'\r\n          ? this.$emit('toolbar:applyStyle', value)\r\n          : this.$emit('toolbar:applyStyle', mergedValue)\r\n    }\r\n  }\r\n}\r\n\r\n","import {SpreadsheetComponent} from '@core/SpreadsheetComponent'\r\nimport {$} from '@core/dom'\r\n\r\nexport class Formula extends SpreadsheetComponent {\r\n  static className = 'spreadsheet__formula'\r\n\r\n  constructor($root, options) {\r\n    super($root, {\r\n      name: 'Formula',\r\n      listeners: ['input', 'keydown'],\r\n      subscribe: ['currentText'],\r\n      ...options\r\n    })\r\n  }\r\n\r\n  toHTML() {\r\n    return `\r\n      <div class=\"spreadsheet__formula__inner\">\r\n        <div class=\"formula__info\"></div>\r\n        <span class=\"divider\"></span>\r\n        <div class=\"formula__label\">fx</div>\r\n        <span class=\"divider\"></span>\r\n        <div \r\n        id=\"formula\" class=\"formula__input\"\r\n        contenteditable=\"true\" spellcheck=\"false\"\r\n        >\r\n        </div>\r\n      </div>\r\n    `\r\n  }\r\n\r\n  init() {\r\n    super.init()\r\n\r\n    this.$formula = this.$root.findDom('#formula')\r\n\r\n    this.$on('table:select', $cell => {\r\n      this.$formula.text($cell.data.value)\r\n    })\r\n  }\r\n\r\n  storeChanged({currentText}) {\r\n    this.$formula.text(currentText)\r\n  }\r\n\r\n  onInput(event) {\r\n    this.$emit('formula:input', $(event.target).text())\r\n  }\r\n\r\n  onKeydown(event) {\r\n    const keys = ['Enter', 'Tab']\r\n    if (keys.includes(event.key)) {\r\n      event.preventDefault()\r\n      this.$emit('formula:done')\r\n    }\r\n  }\r\n}\r\n","import {wrap} from '@core/utils'\r\nimport {toInlineStyles} from '@core/utils'\r\nimport {defaultStyles} from '@/constants'\r\nimport {parse} from '@core/parse'\r\n\r\nconst CODES = {\r\n  A: 65,\r\n  Z: 90\r\n}\r\n\r\nconst DEFAULT_WIDTH = 100\r\nconst DEFAULT_HEIGHT = 21\r\n\r\nexport function toChar(index) {\r\n  return String.fromCharCode(CODES.A + index)\r\n}\r\n\r\nfunction getWidth(state, index) {\r\n  return (state[toChar(index)] || DEFAULT_WIDTH) + 'px'\r\n}\r\n\r\nfunction getHeight(state, index) {\r\n  return (state[index] || DEFAULT_HEIGHT) + 'px'\r\n}\r\n\r\nfunction insertSelection() {\r\n  return `\r\n    <div class=\"table-selection\" \r\n      data-type=\"selection\"\r\n    >\r\n    </div>\r\n  `\r\n}\r\n\r\nfunction toCell(row, state) {\r\n  return function(_, index) {\r\n    const id = `${row}:${index + 1}`\r\n    const indexChar = toChar(index)\r\n    const width = getWidth(state.colState, index)\r\n    const data = state.dataState[id]\r\n    const styles = toInlineStyles({\r\n      ...defaultStyles,\r\n      ...state.stylesState[id]\r\n    })\r\n    return `\r\n      <div \r\n        class=\"cell\" contenteditable \r\n        data-type=\"cell\"\r\n        data-row=\"${row}\" \r\n        data-col=\"${indexChar}\"\r\n        data-id=\"${id}\"\r\n        data-value=\"${data || ''}\"\r\n        style=\"${styles}; width: ${width}\"\r\n      >\r\n      <span>${parse(data) || ''}</span>\r\n      </div>\r\n    `\r\n  }\r\n}\r\n\r\nfunction toColLabel({index, width}) {\r\n  const indexChar = toChar(index)\r\n  return `\r\n    <div \r\n      class=\"col--label\" \r\n      data-type=\"resizable\" \r\n      data-col=\"${indexChar}\"\r\n      style=\"width: ${width}\"\r\n    >\r\n      ${indexChar}\r\n      <div class=\"col__resize\" data-resize=\"col\"></div>\r\n      <div class=\"col__resize-line\" data-resize-line=\"col\"></div>\r\n    </div>\r\n  `\r\n}\r\n\r\nfunction createNotationCol(content) {\r\n  return `\r\n    <div\r\n      class=\"notation-col\"\r\n      data-type=\"notation-col\"\r\n    >\r\n      ${content}\r\n    </div>\r\n  `\r\n}\r\n\r\nfunction toRowLabel(state) {\r\n  return function(_, index) {\r\n    const height = getHeight(state.rowState, index + 1)\r\n    return `\r\n      <div\r\n        class=\"row row--label\" \r\n        data-type=\"resizable\" \r\n        data-row=\"${index + 1}\"\r\n        style=\"height: ${height}\"\r\n      >\r\n        ${index + 1}\r\n        <div class=\"row__resize\" data-resize=\"row\"></div>\r\n        <div class=\"row__resize-line\" data-resize-line=\"row\"></div>\r\n      </div>\r\n    `\r\n  }\r\n}\r\n\r\nfunction createRow(content, index, rowState, rowType) {\r\n  const height = rowType === 'notation-row'\r\n      ? '' : `style=\"height: ${getHeight(rowState, index)}\"`\r\n  const className = rowType\r\n  const selector = rowType === 'notation-row'\r\n      ? '<div class=\"selector\"></div>' : ''\r\n  const dataType = rowType === 'notation-row'\r\n      ? `data-type=\"notation-row\"` : ''\r\n  return `\r\n    <div\r\n      class=\"${className}\" \r\n      data-row=\"${index}\"\r\n      ${dataType}\r\n      ${height}\r\n    >\r\n      ${selector}\r\n      ${content}\r\n    </div>\r\n  `\r\n}\r\n\r\nfunction withWidthFrom(state) {\r\n  return function(_, index) {\r\n    return {\r\n      index, width: getWidth(state.colState, index)\r\n    }\r\n  }\r\n}\r\n\r\nfunction withHeightFrom(state) {\r\n  return function(_, index) {\r\n    return {\r\n      index, height: getHeight(state.rowState, index)\r\n    }\r\n  }\r\n}\r\n\r\nexport function createTable(rowsCount, colsCount, state = {}) {\r\n  const rows = []\r\n\r\n  const colLabels = new Array(colsCount)\r\n      .fill('')\r\n      .map(withWidthFrom(state))\r\n      .map(toColLabel)\r\n      .join('')\r\n\r\n  const notationRow = createRow(colLabels, '', {}, 'notation-row')\r\n\r\n  const rowLabels = new Array(rowsCount)\r\n      .fill('')\r\n      .map(withHeightFrom(state))\r\n      .map(toRowLabel(state))\r\n      .join('')\r\n\r\n  const notationCol = createNotationCol(rowLabels)\r\n\r\n  for (let row = 1; row <= rowsCount; row++) {\r\n    const cells = new Array(colsCount)\r\n        .fill('')\r\n        .map(toCell(row, state))\r\n        .join('')\r\n\r\n    rows.push(createRow(cells, row, state.rowState, 'row'))\r\n  }\r\n\r\n  let grid = wrap(insertSelection() + rows.join(''),\r\n      'div', 'grid', 'data-type=\"grid\"')\r\n  grid = wrap(notationCol + grid,\r\n      'div', 'grid-scrollable-wrapper', 'data-type=\"scrollable\"')\r\n  grid = wrap(grid, 'div', 'grid-fixed-container', 'data-type=\"fixed\"')\r\n\r\n\r\n  return wrap(notationRow + grid, 'div', 'spreadsheet__table__inner')\r\n}\r\n","import {$} from '@core/dom'\r\nimport {toChar} from '@/components/table/table.template'\r\n\r\nexport class TableSelection {\r\n  static className = 'selected'\r\n  static selectionType = `[data-type=\"selection\"]`\r\n  static cell = 'cell'\r\n  static gridType = `[data-type=\"grid\"]`\r\n  static scrollableType = `[data-type=\"scrollable\"]`\r\n  static fixedType = `[data-type=\"fixed\"]`\r\n  static selectionClasses = {\r\n    active: 'table-selection--active',\r\n    bordered: 'table-selection--bordered'\r\n  }\r\n  static notationTypes = {\r\n    row: `[data-type=\"notation-row\"]`,\r\n    col: `[data-type=\"notation-col\"]`\r\n  }\r\n\r\n  constructor() {\r\n    this.group = []\r\n    this.current = null\r\n    this.selection = null\r\n    this.labels = {\r\n      rows: [],\r\n      cols: []\r\n    }\r\n  }\r\n\r\n  get selectedIds() {\r\n    return this.group.map($el => $el.id())\r\n  }\r\n\r\n  range(start, end) {\r\n    if (start > end) {\r\n      [end, start] = [start, end]\r\n    }\r\n\r\n    return new Array(end - start + 1)\r\n        .fill('')\r\n        .map((_, index) => start + index)\r\n  }\r\n\r\n  setClasses($root, $el, rows, cols) {\r\n    const $notationRow = $root.findDom(TableSelection.notationTypes.row)\r\n    const $notationCol = $root.findDom(TableSelection.notationTypes.col)\r\n\r\n    if (typeof(rows) === 'undefined' || typeof(cols) === 'undefined') {\r\n      const $col = $notationRow.findDom(`[data-col=\"${this.current.data.col}\"]`)\r\n      const $row = $notationCol.findDom(`[data-row=\"${this.current.data.row}\"]`)\r\n      this.labels.cols.push($col)\r\n      this.labels.rows.push($row)\r\n      $col.addClass(TableSelection.className)\r\n      $row.addClass(TableSelection.className)\r\n    } else {\r\n      const $cols = cols\r\n          .map(col => $notationRow.findDom(`[data-col=\"${toChar(col - 1)}\"]`))\r\n      const $rows = rows\r\n          .map(row => $notationCol.findDom(`[data-row=\"${row}\"]`))\r\n      $cols.forEach($el => this.labels.cols.push($el))\r\n      $rows.forEach($el => this.labels.rows.push($el))\r\n      $cols.forEach($el => $el.addClass(TableSelection.className))\r\n      $rows.forEach($el => $el.addClass(TableSelection.className))\r\n    }\r\n\r\n    this.current.focus().addClass(TableSelection.className)\r\n  }\r\n\r\n  selectionBordered() {\r\n    this.selection.addClass(TableSelection.selectionClasses.bordered)\r\n  }\r\n\r\n  selectionHandler($root) {\r\n    document.onmousemove = e => {\r\n      const $el = $(document.elementFromPoint(e.pageX, e.pageY))\r\n      if ($el.data.type === TableSelection.cell) {\r\n        this.selectGroup($root, $el)\r\n      }\r\n    }\r\n\r\n    document.onmouseup = () => {\r\n      document.onmousemove = null\r\n      document.onmouseup = null\r\n      if (this.selection !== null) {\r\n        this.selectionBordered()\r\n      }\r\n    }\r\n  }\r\n\r\n  setSelectionCSS(top, right, bottom, left, scroll, offset) {\r\n    this.selection.css({\r\n      top: top + scroll.top - offset.top + 'px',\r\n      left: left + scroll.left - offset.left + 'px',\r\n      height: bottom - top + 'px',\r\n      width: right - left + 'px'\r\n    })\r\n  }\r\n\r\n  setSelection($root, $el) {\r\n    const targetId = $el.id(true)\r\n    const currentId = this.current.id(true)\r\n    const targetCoords = $el.getCoords()\r\n    const currentCoords = this.current.getCoords()\r\n    this.selection = $root.findDom(TableSelection.selectionType)\r\n    const $gridScrollable = $el.closest(TableSelection.scrollableType)\r\n    const $gridFixed = $el.closest(TableSelection.fixedType)\r\n    const $grid = $el.closest(TableSelection.gridType)\r\n    const scroll = $gridScrollable.getScroll()\r\n    const offset = {\r\n      top: $root.getOffset().top + $gridFixed.getOffset().top,\r\n      left: $grid.getOffset().left\r\n    }\r\n    this.selection.addClass(TableSelection.selectionClasses.active)\r\n\r\n    if (targetId.row <= currentId.row &&\r\n      targetId.col >= currentId.col) {\r\n      this.setSelectionCSS(\r\n          targetCoords.top,\r\n          targetCoords.right,\r\n          currentCoords.bottom,\r\n          currentCoords.left,\r\n          scroll,\r\n          offset\r\n      )\r\n    } else if (targetId.row >= currentId.row &&\r\n      targetId.col >= currentId.col) {\r\n      this.setSelectionCSS(\r\n          currentCoords.top,\r\n          targetCoords.right,\r\n          targetCoords.bottom,\r\n          currentCoords.left,\r\n          scroll,\r\n          offset\r\n      )\r\n    } else if (targetId.row >= currentId.row &&\r\n      targetId.col <= currentId.col) {\r\n      this.setSelectionCSS(\r\n          currentCoords.top,\r\n          currentCoords.right,\r\n          targetCoords.bottom,\r\n          targetCoords.left,\r\n          scroll,\r\n          offset\r\n      )\r\n    } else if (targetId.row <= currentId.row &&\r\n      targetId.col <= currentId.col) {\r\n      this.setSelectionCSS(\r\n          targetCoords.top,\r\n          currentCoords.right,\r\n          currentCoords.bottom,\r\n          targetCoords.left,\r\n          scroll,\r\n          offset\r\n      )\r\n    }\r\n  }\r\n\r\n  select($root, $el) {\r\n    this.current = $el\r\n    this.clear()\r\n    this.group.push($el)\r\n    this.setClasses($root, $el)\r\n  }\r\n\r\n  selectGroup($root, $el) {\r\n    const targetId = $el.id(true)\r\n    const currentId = this.current.id(true)\r\n\r\n    const rows = this.range(currentId.row, targetId.row)\r\n    const cols = this.range(currentId.col, targetId.col)\r\n\r\n    const ids = rows.reduce((acc, row) => {\r\n      cols.forEach(col => acc.push(`${row}:${col}`))\r\n      return acc\r\n    }, [])\r\n\r\n    const $cells = ids.map(id => $root.findDom(`[data-id=\"${id}\"]`))\r\n\r\n    this.clear()\r\n    this.setSelection($root, $el)\r\n    this.group = $cells\r\n    this.setClasses($root, $el, rows, cols)\r\n  }\r\n\r\n  clear() {\r\n    this.group.forEach($el => $el.removeClass(TableSelection.className))\r\n    this.group = []\r\n    this.labels.rows.forEach($el => $el.removeClass(TableSelection.className))\r\n    this.labels.rows = []\r\n    this.labels.cols.forEach($el => $el.removeClass(TableSelection.className))\r\n    this.labels.cols = []\r\n\r\n    if (this.selection !== null) {\r\n      this.selection.removeClass(TableSelection\r\n          .selectionClasses.active)\r\n      this.selection.removeClass(TableSelection\r\n          .selectionClasses.bordered)\r\n    }\r\n  }\r\n\r\n  applyStyle(style) {\r\n    this.group.forEach($el => $el.css(style))\r\n  }\r\n}\r\n","import {SpreadsheetComponent} from '@core/SpreadsheetComponent'\r\nimport {$} from '@core/dom'\r\nimport {createTable} from '@/components/table/table.template'\r\nimport {resizeHandler} from '@/components/table/table.resize'\r\nimport {shouldResize, nextSelector} from '@/components/table/table.functions'\r\nimport {TableSelection} from '@/components/table/TableSelection'\r\nimport {isCell} from '@/components/table/table.functions'\r\nimport * as actions from '@/redux/actions'\r\nimport {defaultStyles} from '@/constants'\r\nimport {parse} from '@core/parse'\r\n\r\nexport class Table extends SpreadsheetComponent {\r\n  static className = 'spreadsheet__table'\r\n\r\n  constructor($root, options) {\r\n    super($root, {\r\n      name: 'Table',\r\n      listeners: ['mousedown', 'keydown', 'input'],\r\n      ...options\r\n    })\r\n    this.tableSize = {\r\n      rows: 100,\r\n      cols: 26\r\n    }\r\n  }\r\n\r\n  toHTML() {\r\n    return createTable(this.tableSize.rows, this.tableSize.cols,\r\n        this.store.getState())\r\n  }\r\n\r\n  prepare() {\r\n    this.tableSelection = new TableSelection()\r\n  }\r\n\r\n  init() {\r\n    super.init()\r\n\r\n    this.selectCell(this.$root, this.$root.findDom('[data-id=\"1:1\"'))\r\n\r\n    this.$on('formula:input', value => {\r\n      this.tableSelection.current\r\n          .attribute('data-value', value)\r\n          .text(parse(value))\r\n      this.updateTextInStore(value)\r\n    })\r\n\r\n    this.$on('formula:done', () => {\r\n      this.tableSelection.current.focus()\r\n    })\r\n\r\n    this.$on('toolbar:applyStyle', value => {\r\n      this.tableSelection.applyStyle(value)\r\n      this.$dispatch(actions.applyStyle({\r\n        value,\r\n        ids: this.tableSelection.selectedIds\r\n      }))\r\n    })\r\n  }\r\n\r\n  selectCell($root, $cell) {\r\n    this.tableSelection.select($root, $cell)\r\n    this.$emit('table:select', $cell)\r\n    const styles = $cell.getStyles(Object.keys(defaultStyles))\r\n    this.$dispatch(actions.changeStyles(styles))\r\n  }\r\n\r\n  async resizeTable(event) {\r\n    try {\r\n      const data = await resizeHandler(this.$root, event)\r\n      this.$dispatch(actions.tableResize(data))\r\n    } catch (e) {\r\n      console.warn('Resize error', e.message)\r\n    }\r\n  }\r\n\r\n  onMousedown(event) {\r\n    if (shouldResize(event)) {\r\n      this.resizeTable(event)\r\n    } else if (isCell(event)) {\r\n      if (event.shiftKey) {\r\n        this.tableSelection.selectGroup(this.$root, $(event.target))\r\n        this.tableSelection.selectionBordered()\r\n      } else {\r\n        this.selectCell(this.$root, $(event.target))\r\n        this.tableSelection.selectionHandler(this.$root)\r\n      }\r\n    }\r\n  }\r\n\r\n  onKeydown(event) {\r\n    const keys = [\r\n      'Enter',\r\n      'Tab',\r\n      'ArrowUp',\r\n      'ArrowDown',\r\n      'ArrowLeft',\r\n      'ArrowRight'\r\n    ]\r\n\r\n    const {key} = event\r\n\r\n    if (keys.includes(key) && !event.shiftKey) {\r\n      event.preventDefault()\r\n      const id = this.tableSelection.current.id(true)\r\n      const $next = this.$root.findDom(nextSelector(key, id, this.tableSize))\r\n      this.selectCell(this.$root, $next)\r\n      this.$emit('table:select', $next)\r\n    }\r\n  }\r\n\r\n  updateTextInStore(value) {\r\n    this.$dispatch(actions.changeText({\r\n      id: this.tableSelection.current.id(),\r\n      value\r\n    }))\r\n  }\r\n\r\n  onInput(event) {\r\n    this.updateTextInStore($(event.target).text())\r\n  }\r\n}\r\n","import {$} from '@core/dom'\r\n\r\nfunction findRow(event, rowId) {\r\n  const $table = $(event.target).closest('.spreadsheet__table')\r\n  const $grid = $table.findDom('.grid')\r\n  return $grid.findDom(`[data-row=\"${rowId}\"]`)\r\n}\r\n\r\nexport function resizeHandler($root, event) {\r\n  return new Promise(resolve => {\r\n    const $resizer = $(event.target)\r\n    const $parent = $resizer.closest('[data-type=\"resizable\"]')\r\n    const eventType = $resizer.data.resize\r\n    const $row = eventType === 'col' ? '' : findRow(event, $parent.data.row)\r\n    const coords = $parent.getCoords()\r\n    let value\r\n    const $resizerLine = $parent.findDom(`[data-resize-line=\"${eventType}\"]`)\r\n    const $cells = $root.findAll(\r\n        `[data-col=\"${$parent.data.col}\"]`\r\n    )\r\n    const property = eventType === 'col' ? 'min-width' : 'min-height'\r\n    const minValue = Number($parent.getPropertyValue(\r\n        $parent.$el, property\r\n    ).slice(0, -2))\r\n\r\n    if (eventType === 'col') {\r\n      const tableHeight = $root.getPropertyValue(\r\n          $root.$el, 'height'\r\n      )\r\n      $resizerLine.css({height: tableHeight})\r\n    }\r\n\r\n    document.onmousemove = e => {\r\n      if (eventType === 'col') {\r\n        const delta = e.pageX - coords.right\r\n        value = coords.width + delta\r\n\r\n        if (value >= minValue) {\r\n          $resizer.css({right: -delta -5 + 'px'})\r\n          $resizerLine.css({right: -delta + 2 + 'px'})\r\n        }\r\n      } else {\r\n        const delta = e.pageY - coords.bottom\r\n        value = coords.height + delta\r\n\r\n        if (value >= minValue) {\r\n          $resizer.css({bottom: -delta -5 + 'px'})\r\n          $resizerLine.css({bottom: -delta + 2 + 'px'})\r\n        }\r\n      }\r\n    }\r\n\r\n    document.onmouseup = () => {\r\n      document.onmousemove = null\r\n      document.onmouseup = null\r\n\r\n      if (eventType === 'col') {\r\n        if (value >= minValue) {\r\n          $cells.forEach(el => el.style.width = value + 'px')\r\n        } else {\r\n          $cells.forEach(el => el.style.width = minValue + 'px')\r\n        }\r\n\r\n        $resizer.css({right: -5 + 'px'})\r\n        $resizerLine.css({right: 2 + 'px'})\r\n      } else {\r\n        if (value >= minValue) {\r\n          $parent.css({height: value + 'px'})\r\n          $row.css({height: value + 'px'})\r\n        } else {\r\n          $parent.css({height: minValue + 'px'})\r\n          $row.css({height: minValue + 'px'})\r\n        }\r\n\r\n        $resizer.css({bottom: -5 + 'px'})\r\n        $resizerLine.css({bottom: 2 + 'px'})\r\n      }\r\n\r\n      resolve({\r\n        value: value > minValue ? value : minValue,\r\n        eventType,\r\n        id: $parent.data[eventType]\r\n      })\r\n    }\r\n  })\r\n}\r\n","export function shouldResize(event) {\r\n  return event.target.dataset.resize\r\n}\r\n\r\nexport function isCell(event) {\r\n  return event.target.dataset.type === 'cell'\r\n}\r\n\r\nexport function nextSelector(key, {row, col}, {rows, cols}) {\r\n  const MIN_VALUE = 1\r\n\r\n  switch (key) {\r\n    case 'Enter':\r\n      row = row + 1 < rows ? row + 1 : rows\r\n      break\r\n    case 'Tab': col++\r\n      break\r\n    case 'ArrowUp':\r\n      row = row - 1 < MIN_VALUE ? MIN_VALUE : row - 1\r\n      break\r\n    case 'ArrowDown':\r\n      row = row + 1 < rows ? row + 1 : rows\r\n      break\r\n    case 'ArrowLeft':\r\n      col = col - 1 < MIN_VALUE ? MIN_VALUE : col - 1\r\n      break\r\n    case 'ArrowRight':\r\n      col = col + 1 < cols ? col + 1 : cols\r\n      break\r\n  }\r\n\r\n  return `[data-id=\"${row}:${col}\"]`\r\n}\r\n","import {\r\n  TABLE_RESIZE,\r\n  CHANGE_TEXT,\r\n  CHANGE_STYLES,\r\n  APPLY_STYLE,\r\n  CHANGE_TITLE,\r\n  UPDATE_DATE\r\n} from './types'\r\n\r\nexport function rootReducer(state, action) {\r\n  let field\r\n  let val\r\n\r\n  switch (action.type) {\r\n    case TABLE_RESIZE:\r\n      field = action.data.eventType === 'col' ? 'colState' : 'rowState'\r\n      return {...state, [field]: getValue(state, field, action)}\r\n    case CHANGE_TEXT:\r\n      field = 'dataState'\r\n      return {\r\n        ...state,\r\n        currentText: action.data.value,\r\n        [field]: getValue(state, field, action)\r\n      }\r\n    case CHANGE_STYLES:\r\n      return {...state, currentStyles: action.data}\r\n    case APPLY_STYLE:\r\n      field = 'stylesState'\r\n      val = state[field] || {}\r\n      action.data.ids.forEach(id => {\r\n        val[id] = {...val[id], ...action.data.value}\r\n      })\r\n      return {\r\n        ...state,\r\n        [field]: val,\r\n        currentStyles: {...state.currentStyles, ...action.data.value}\r\n      }\r\n    case CHANGE_TITLE:\r\n      return {...state, tableTitle: action.data}\r\n    case UPDATE_DATE:\r\n      return {...state, lastOpenedDate: new Date().toJSON()}\r\n    default: return state\r\n  }\r\n}\r\n\r\nfunction getValue(state, field, action) {\r\n  const value = state[field] || {}\r\n  value[action.data.id] = action.data.value\r\n  return value\r\n}\r\n","import {defaultStyles, defaultTitle} from '@/constants'\r\nimport {clone} from '@core/utils'\r\n\r\nconst defaultState = {\r\n  tableTitle: defaultTitle,\r\n  rowState: {},\r\n  colState: {},\r\n  dataState: {},\r\n  stylesState: {},\r\n  currentText: '',\r\n  currentStyles: defaultStyles,\r\n  lastOpenedDate: new Date().toJSON()\r\n}\r\n\r\nconst normalize = state => ({\r\n  ...state,\r\n  currentStyles: defaultStyles,\r\n  currentText: ''\r\n})\r\n\r\nexport function normalizeInitialState(state) {\r\n  return state ? normalize(state) : clone(defaultState)\r\n}\r\n","import {debounce} from '@core/utils'\r\n\r\nexport class StateProcessor {\r\n  constructor(client, delay = 250) {\r\n    this.client = client\r\n    this.listen = debounce(this.listen.bind(this), delay)\r\n  }\r\n\r\n  listen(state) {\r\n    this.client.save(state)\r\n  }\r\n\r\n  get() {\r\n    return this.client.get()\r\n  }\r\n}\r\n","import {storage} from '@core/utils'\r\n\r\nfunction storageName(param) {\r\n  return 'spreadsheet:' + param\r\n}\r\n\r\nexport class LocalStorageClient {\r\n  constructor(name) {\r\n    this.name = storageName(name)\r\n  }\r\n\r\n  save(state) {\r\n    storage(this.name, state)\r\n    return Promise.resolve()\r\n  }\r\n\r\n  get() {\r\n    return new Promise(resolve => {\r\n      const state = storage(this.name)\r\n\r\n      setTimeout(() => {\r\n        resolve(state)\r\n      }, 1000)\r\n    })\r\n  }\r\n}\r\n","import {Router} from '@core/routes/Router'\r\nimport {DashboardPage} from '@/pages/DashboardPage'\r\nimport './scss/index.scss'\r\nimport {SpreadsheetPage} from '@/pages/SpreadsheetPage'\r\n\r\nnew Router('#app', {\r\n  dashboard: DashboardPage,\r\n  spreadsheet: SpreadsheetPage\r\n})\r\n","import {$} from '@core/dom'\r\nimport {Loader} from '@/components/Loader'\r\nimport {ActiveRoute} from './ActiveRoute'\r\n\r\nexport class Router {\r\n  constructor(selector, routes) {\r\n    if (!selector) {\r\n      throw new Error('Selector for Router is not provided')\r\n    }\r\n\r\n    this.$placeholder = $(selector)\r\n    this.routes = routes\r\n    this.loader = new Loader()\r\n    this.page = null\r\n    this.changePageHandler = this.changePageHandler.bind(this)\r\n\r\n    this.init()\r\n  }\r\n\r\n  init() {\r\n    window.addEventListener('hashchange', this.changePageHandler)\r\n    this.changePageHandler()\r\n  }\r\n\r\n  async changePageHandler() {\r\n    if (this.page) {\r\n      this.page.destroy()\r\n    }\r\n\r\n    this.$placeholder.clear().append(this.loader)\r\n\r\n    const Page = ActiveRoute.path.includes('spreadsheet')\r\n        ? this.routes.spreadsheet\r\n        : this.routes.dashboard\r\n\r\n    this.page = new Page(ActiveRoute.param)\r\n\r\n    const root = await this.page.getRoot()\r\n    this.$placeholder.clear().append(root)\r\n\r\n    this.page.afterRender()\r\n  }\r\n\r\n  destroy() {\r\n    window.removeEventListener('hashchange', this.changePageHandler)\r\n  }\r\n}\r\n","import {Page} from '@core/page/Page'\r\nimport {$} from '@core/dom'\r\nimport {createSpreadsheetsTable} from '@/shared/dashboard.functions'\r\n\r\nexport class DashboardPage extends Page {\r\n  getRoot() {\r\n    const now = Date.now().toString()\r\n    return $.create('div', 'dashboard').html(`\r\n      <div class=\"dashboard__header\">\r\n        <a class=\"dashboard__create\" href=\"#spreadsheet/${now}\"></a>\r\n        <div class=\"dashboard__header__logo\">\r\n          <img src=\"logo.png\" alt=\"Excel\" class=\"img\" />\r\n        </div>\r\n        <span class=\"dashboard__header__title\">Spreadsheets</span>\r\n      </div>\r\n      ${createSpreadsheetsTable()}\r\n    `)\r\n  }\r\n}\r\n","import {Spreadsheet} from '@/components/spreadsheet/Spreadsheet'\r\nimport {Header} from '@/components/header/Header'\r\nimport {Toolbar} from '@/components/toolbar/Toolbar'\r\nimport {Formula} from '@/components/formula/Formula'\r\nimport {Table} from '@/components/table/Table'\r\nimport {createStore} from '@core/store/createStore'\r\nimport {rootReducer} from '@/redux/rootReducer'\r\nimport {normalizeInitialState} from '@/redux/initialState'\r\nimport {Page} from '@core/page/Page'\r\nimport {StateProcessor} from '@core/page/StateProcessor'\r\nimport {LocalStorageClient} from '@/shared/LocalStorageClient'\r\n\r\nexport class SpreadsheetPage extends Page {\r\n  constructor(param) {\r\n    super(param)\r\n\r\n    this.storeSub = null\r\n    this.processor = new StateProcessor(\r\n        new LocalStorageClient(this.params)\r\n    )\r\n  }\r\n\r\n  async getRoot() {\r\n    const state = await this.processor.get()\r\n    const store = createStore(rootReducer, normalizeInitialState(state))\r\n\r\n    this.storeSub = store.subscribe(this.processor.listen)\r\n\r\n    this.spreadsheet = new Spreadsheet({\r\n      components: [Header, Toolbar, Formula, Table],\r\n      store\r\n    })\r\n\r\n    return this.spreadsheet.getRoot()\r\n  }\r\n\r\n  afterRender() {\r\n    this.spreadsheet.init()\r\n  }\r\n\r\n  destroy() {\r\n    this.spreadsheet.destroy()\r\n    this.storeSub.unsubscribe()\r\n  }\r\n}\r\n","export function createStore(rootReducer, initialState = {}) {\r\n  let state = rootReducer({...initialState}, {type: '__INIT__'})\r\n  let listeners = []\r\n\r\n  return {\r\n    subscribe(func) {\r\n      listeners.push(func)\r\n      return {\r\n        unsubscribe() {\r\n          listeners = listeners.filter(listener => listener !== func)\r\n        }\r\n      }\r\n    },\r\n    dispatch(action) {\r\n      state = rootReducer(state, action)\r\n      listeners.forEach(listener => listener(state))\r\n    },\r\n    getState() {\r\n      return JSON.parse(JSON.stringify(state))\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":""}